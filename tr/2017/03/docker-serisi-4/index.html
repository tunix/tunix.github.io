<!doctype html><html lang=tr dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Docker Serisi #4 -- Docker Compose | Alper Kanat</title><meta name=keywords content="yazÄ±lÄ±m,docker,docker serisi,container,sanallaÅŸtÄ±rma,linux,devops"><meta name=description content="bÃ¶lÃ¼me hoÅŸgeldiniz! ğŸ¤˜ğŸ» Serinin Ã¶nceki bÃ¶lÃ¼mlerine ulaÅŸmak iÃ§in aÅŸaÄŸÄ±daki baÄŸlantÄ±larÄ± kullanabilirsiniz: Docker Serisi #1 Docker Serisi #2 â€” Docker Engine BÃ¶lÃ¼m 1 Docker Serisi #3 â€” Docker Engine BÃ¶lÃ¼m 2 Daha Ã§ok geliÅŸtirme Ã¼stÃ¼ne duracak olsam da, Docker Composeâ€™u test ortamÄ± ya da farklÄ± ihtiyaÃ§lar iÃ§in de kullanabilirsiniz. Ã–zellikle tek bir makine Ã¼stÃ¼nde birden fazla container ile Ã§alÄ±ÅŸmayÄ± dÃ¼ÅŸÃ¼nÃ¼yorsanÄ±z Docker Compose mutlaka incelemeniz gereken bir araÃ§!
GÃ¼ncelleme: Docker 1.13 ile birlikte Docker Compose ile tanÄ±mladÄ±ÄŸÄ±nÄ±z bir projeyi Swarm ile birden Ã§ok makineye daÄŸÄ±tabiliyorsunuz!"><meta name=author content><link rel=canonical href=https://alperkan.at/tr/2017/03/docker-serisi-4/><link crossorigin=anonymous href=/assets/css/stylesheet.min.2d6dbfc6e0f8a1db1c9d082a76dc11d094328cf63f247bbc2421dfaa7f2bb170.css integrity="sha256-LW2/xuD4odscnQgqdtwR0JQyjPY/JHu8JCHfqn8rsXA=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.min.b95bacdc39e37a332a9f883b1e78be4abc1fdca2bc1f2641f55e3cd3dabd4d61.js integrity="sha256-uVus3DnjejMqn4g7Hni+Srwf3KK8HyZB9V4809q9TWE=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://alperkan.at/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://alperkan.at/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://alperkan.at/favicon-32x32.png><link rel=apple-touch-icon href=https://alperkan.at/apple-touch-icon.png><link rel=mask-icon href=https://alperkan.at/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.102.3"><link rel=alternate hreflang=tr href=https://alperkan.at/tr/2017/03/docker-serisi-4/><script async src="https://www.googletagmanager.com/gtag/js?id=G-SDT9Y68PM3"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-SDT9Y68PM3",{anonymize_ip:!1})}</script><meta property="og:title" content="Docker Serisi #4 -- Docker Compose"><meta property="og:description" content="bÃ¶lÃ¼me hoÅŸgeldiniz! ğŸ¤˜ğŸ» Serinin Ã¶nceki bÃ¶lÃ¼mlerine ulaÅŸmak iÃ§in aÅŸaÄŸÄ±daki baÄŸlantÄ±larÄ± kullanabilirsiniz: Docker Serisi #1 Docker Serisi #2 â€” Docker Engine BÃ¶lÃ¼m 1 Docker Serisi #3 â€” Docker Engine BÃ¶lÃ¼m 2 Daha Ã§ok geliÅŸtirme Ã¼stÃ¼ne duracak olsam da, Docker Composeâ€™u test ortamÄ± ya da farklÄ± ihtiyaÃ§lar iÃ§in de kullanabilirsiniz. Ã–zellikle tek bir makine Ã¼stÃ¼nde birden fazla container ile Ã§alÄ±ÅŸmayÄ± dÃ¼ÅŸÃ¼nÃ¼yorsanÄ±z Docker Compose mutlaka incelemeniz gereken bir araÃ§!
GÃ¼ncelleme: Docker 1.13 ile birlikte Docker Compose ile tanÄ±mladÄ±ÄŸÄ±nÄ±z bir projeyi Swarm ile birden Ã§ok makineye daÄŸÄ±tabiliyorsunuz!"><meta property="og:type" content="article"><meta property="og:url" content="https://alperkan.at/tr/2017/03/docker-serisi-4/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2017-03-20T00:00:00+00:00"><meta property="article:modified_time" content="2021-04-26T00:02:59+03:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Docker Serisi #4 -- Docker Compose"><meta name=twitter:description content="bÃ¶lÃ¼me hoÅŸgeldiniz! ğŸ¤˜ğŸ» Serinin Ã¶nceki bÃ¶lÃ¼mlerine ulaÅŸmak iÃ§in aÅŸaÄŸÄ±daki baÄŸlantÄ±larÄ± kullanabilirsiniz: Docker Serisi #1 Docker Serisi #2 â€” Docker Engine BÃ¶lÃ¼m 1 Docker Serisi #3 â€” Docker Engine BÃ¶lÃ¼m 2 Daha Ã§ok geliÅŸtirme Ã¼stÃ¼ne duracak olsam da, Docker Composeâ€™u test ortamÄ± ya da farklÄ± ihtiyaÃ§lar iÃ§in de kullanabilirsiniz. Ã–zellikle tek bir makine Ã¼stÃ¼nde birden fazla container ile Ã§alÄ±ÅŸmayÄ± dÃ¼ÅŸÃ¼nÃ¼yorsanÄ±z Docker Compose mutlaka incelemeniz gereken bir araÃ§!
GÃ¼ncelleme: Docker 1.13 ile birlikte Docker Compose ile tanÄ±mladÄ±ÄŸÄ±nÄ±z bir projeyi Swarm ile birden Ã§ok makineye daÄŸÄ±tabiliyorsunuz!"><script type=application/ld+json>
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://alperkan.at/tr/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Docker Serisi #4 -- Docker Compose",
      "item": "https://alperkan.at/tr/2017/03/docker-serisi-4/"
    }
  ]
}
</script><script type=application/ld+json>
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Docker Serisi #4 -- Docker Compose",
  "name": "Docker Serisi #4 -- Docker Compose",
  "description": "bÃ¶lÃ¼me hoÅŸgeldiniz! ğŸ¤˜ğŸ» Serinin Ã¶nceki bÃ¶lÃ¼mlerine ulaÅŸmak iÃ§in aÅŸaÄŸÄ±daki baÄŸlantÄ±larÄ± kullanabilirsiniz: Docker Serisi #1 Docker Serisi #2 â€” Docker Engine BÃ¶lÃ¼m 1 Docker Serisi #3 â€” Docker Engine BÃ¶lÃ¼m 2 Daha Ã§ok geliÅŸtirme Ã¼stÃ¼ne duracak olsam da, Docker Composeâ€™u test ortamÄ± ya da farklÄ± ihtiyaÃ§lar iÃ§in de kullanabilirsiniz. Ã–zellikle tek bir makine Ã¼stÃ¼nde birden fazla container ile Ã§alÄ±ÅŸmayÄ± dÃ¼ÅŸÃ¼nÃ¼yorsanÄ±z Docker Compose mutlaka incelemeniz gereken bir araÃ§!\nGÃ¼ncelleme: Docker 1.13 ile birlikte Docker Compose ile tanÄ±mladÄ±ÄŸÄ±nÄ±z bir projeyi Swarm ile birden Ã§ok makineye daÄŸÄ±tabiliyorsunuz!",
  "keywords": [
    "yazÄ±lÄ±m", "docker", "docker serisi", "container", "sanallaÅŸtÄ±rma", "linux", "devops"
  ],
  "articleBody": " bÃ¶lÃ¼me hoÅŸgeldiniz! ğŸ¤˜ğŸ» Serinin Ã¶nceki bÃ¶lÃ¼mlerine ulaÅŸmak iÃ§in aÅŸaÄŸÄ±daki baÄŸlantÄ±larÄ± kullanabilirsiniz: Docker Serisi #1 Docker Serisi #2 â€” Docker Engine BÃ¶lÃ¼m 1 Docker Serisi #3 â€” Docker Engine BÃ¶lÃ¼m 2 Daha Ã§ok geliÅŸtirme Ã¼stÃ¼ne duracak olsam da, Docker Composeâ€™u test ortamÄ± ya da farklÄ± ihtiyaÃ§lar iÃ§in de kullanabilirsiniz. Ã–zellikle tek bir makine Ã¼stÃ¼nde birden fazla container ile Ã§alÄ±ÅŸmayÄ± dÃ¼ÅŸÃ¼nÃ¼yorsanÄ±z Docker Compose mutlaka incelemeniz gereken bir araÃ§!\nGÃ¼ncelleme: Docker 1.13 ile birlikte Docker Compose ile tanÄ±mladÄ±ÄŸÄ±nÄ±z bir projeyi Swarm ile birden Ã§ok makineye daÄŸÄ±tabiliyorsunuz! ğŸ‰ Seride buna da yer vermek farz oldu tabii ki!\nÃ–zetle; uygulamanÄ±zÄ±, projenize yerleÅŸtireceÄŸiniz docker-compose.yml adÄ±nda bir dosya aracÄ±lÄ±ÄŸÄ±yla servisler olarak tanÄ±mlamanÄ±za olanak tanÄ±r ve Ã§alÄ±ÅŸtÄ±rdÄ±ÄŸÄ±nÄ±zda ilgili containerâ€™larÄ±, disk bÃ¶lÃ¼mlerini, aÄŸlarÄ± vb. her ÅŸeyi oluÅŸturup iÅŸiniz bittiÄŸinde de tamamen kaldÄ±rÄ±r. O zaman kurulum ile hemen iÅŸe koyulalÄ±m! ğŸ˜Š\nKurulum Kurulum iÃ§in ÅŸuradaki dÃ¶kÃ¼manÄ± takip edebilirsiniz. macOS ve brew kullanÄ±yorsanÄ±z;\nbrew install docker-compose komutuyla kurulumu tamamlayabilirsiniz. EÄŸer makinenizde Python (pip \u003e= 6.0) kullanÄ±yorsanÄ±z;\npip install docker-compose komutunu kullanabilirsiniz. Alternatif olarak aÅŸaÄŸÄ±daki komutlar ile de kurulumu gerÃ§ekleÅŸtirebilirsiniz:\n# curl -L https://github.com/docker/compose/releases/download/1.9.0/docker-compose-`uname -s`-`uname -m` \u003e /usr/local/bin/docker-compose # chmod +x /usr/local/bin/docker-compose Kurulumu baÅŸarÄ±yla tamamladÄ±ysanÄ±z aÅŸaÄŸÄ±daki gibi sÃ¼rÃ¼m numarasÄ± Ã§Ä±ktÄ±sÄ±nÄ± gÃ¶rebilmelisiniz:\n$ docker-compose --version docker-compose version 1.11.2, build dfed245 YazÄ±nÄ±n bundan sonraki bÃ¶lÃ¼mÃ¼nde ÅŸu adreste bulabileceÄŸiniz Ã¶rnek projeyi kullanarak devam edeceÄŸim. Dilerseniz indirip benimle beraber adÄ±mlarÄ± tekrarlayabilir ve denemeler yapabilirsiniz.\ndocker-compose.yml Normalde projenizin ana dizinine tek bir docker-compose.yml dosyasÄ± koymak yeterli olmakla beraber, bir dizin birden fazla alt projeye ev sahipliÄŸi yapÄ±yorsa bu durumda alt dizinlere de birer tane docker-compose.yml dosyasÄ± yerleÅŸtirebilirsiniz. Bu durumda -f parametresiyle dosya yolunu belirtmelisiniz.\nDosyanÄ±n biÃ§imi, kullanÄ±labilecek anahtar kelimeler vb. iÃ§in ÅŸuradaki belgeyi inceleyebilirsiniz. Klasik bir docker-compose.yml dosyasÄ± yaklaÅŸÄ±k olarak aÅŸaÄŸÄ±daki gibidir:\nYML dosyasÄ± yazarken, bu dosya biÃ§imine has yazÄ±m kurallarÄ±na dikkat etmelisiniz. KapsamÄ± iyice geniÅŸletmemek adÄ±na yazÄ±m kurallarÄ±na girmeyeceÄŸim ancak Ã¶zellikle girintilemeye Ã¶zen gÃ¶stermelisiniz.\nÄ°lk satÄ±r dosyanÄ±n biÃ§imlendirmesinde kullanÄ±lan tanÄ±mlamalarÄ±n (spec) sÃ¼rÃ¼mÃ¼nÃ¼ belirtiyor ve ilk satÄ±rda olma zorunluluÄŸu var. Docker 1.13 Ã¶ncesinde sÃ¼rÃ¼m numarasÄ± olarak yalnÄ±zca â€œ2â€ kullanÄ±lÄ±rken, artÄ±k â€œ3â€ de kullanÄ±labiliyor. SÃ¼rÃ¼m numarasÄ±, dosyanÄ±n biÃ§iminde yapÄ±labilecek deÄŸiÅŸikliklerden etkilenilmemesi iÃ§in dÃ¼ÅŸÃ¼nÃ¼lmÃ¼ÅŸ bir Ã¶zellik. Yani eski bir projenizde sÃ¼rÃ¼m olarak â€œ2â€ kullanÄ±yorsanÄ±z, artÄ±k desteklenmeyen bir Docker sÃ¼rÃ¼mÃ¼ kullanmÄ±yorsanÄ±z, projeniz olduÄŸu gibi Ã§alÄ±ÅŸacaktÄ±r. Yeni bir projeye baÅŸladÄ±ÄŸÄ±nÄ±zda sÃ¼rÃ¼mÃ¼ â€œ3â€ olarak belirtmeli ve yazÄ±m kurallarÄ±nÄ± da bu sÃ¼rÃ¼me uyacak ÅŸekilde uygulamalÄ±sÄ±nÄ±z.\nDosyada tanÄ±mlamanÄ±z gereken ikinci kÄ±sÄ±m: servisler. Her bir servisi, ayrÄ± birer container gibi dÃ¼ÅŸÃ¼nebilirsiniz. â€œservicesâ€ kelimesinin altÄ±nda, 1 girintileme ile ayÄ±rdÄ±ÄŸÄ±nÄ±z her ÅŸey bir servistir ve Ã§alÄ±ÅŸacak containerâ€™Ä±n adÄ± burada yazdÄ±ÄŸÄ±nÄ±z kelimeyle anÄ±lacaktÄ±r.\nÄ°lk servisimiz adÄ±ndan da anlaÅŸÄ±labileceÄŸi gibi API hizmeti sunan bir containerâ€™dan ibaret. AynÄ± servisten birden Ã§ok kez baÅŸlatma ihtimaline karÅŸÄ±lÄ±k Compose, yazdÄ±ÄŸÄ±nÄ±z ismi, YML dosyasÄ±nÄ±n bulunduÄŸu dizin adÄ± ve bir rakamla harmanlayÄ±p container adÄ± (Ã¶r: dockercomposedemo_api_1) yaratÄ±r. YalnÄ±zca tek bir container baÅŸlatacaÄŸÄ±nÄ±zdan eminseniz servis tanÄ±mlarÄ±na\ncontainer_name: demo-api yazarak bu isimle aÃ§Ä±lmasÄ±nÄ± saÄŸlayabilirsiniz. Bu durumda birden fazla container baÅŸlatmaya Ã§alÄ±ÅŸÄ±rsanÄ±z hata alÄ±rsÄ±nÄ±z.\nServisimizin adÄ±nÄ±n altÄ±nda bir kez daha girintileme ile yazdÄ±ÄŸÄ±mÄ±z her ÅŸey servisi tanÄ±mlayan ayarlar olarak algÄ±lanÄ±r. Åimdi gelin; sÄ±rasÄ±yla yazdÄ±klarÄ±mÄ±zÄ± anlamaya Ã§alÄ±ÅŸalÄ±m:\nbuild: . KÄ±saca imajÄ± oluÅŸturulacak Dockerfile dosyasÄ±nÄ±n yerini (build context) belirtmek iÃ§in kullanÄ±lÄ±r. Bizim projemizde Dockerfile, YML dosyasÄ±yla aynÄ± dizinde bulunduÄŸu iÃ§in â€œ.â€ (nokta) ile bu dizini iÅŸaret ediyoruz. Dilerseniz farklÄ± bir dizindeki Dockerfileâ€™Ä± iÅŸaret edebilir, Dockerfile yerine farklÄ± bir isim kullanÄ±yorsanÄ±z ya da imajÄ± yaratabilmek iÃ§in ek parametrelere ihtiyaÃ§ duyuyorsanÄ±z bunlarÄ± da bu kÄ±sÄ±mda belirtebilirsiniz. Detaylar iÃ§in tÄ±k tÄ±k.\nSwarm modunda bu parametre gÃ¶zardÄ± edilmekte ve bir alttaki image parametresi kullanÄ±lmaktadÄ±r.\nimage: tunix/docker-compose-demo Ä°majÄ±n derlenmesi sonucunda Ã§Ä±kacak Docker imajÄ±nÄ±n adÄ±nÄ± bu komutla belirtiyoruz. HiÃ§ bir ÅŸey yazmazsanÄ±z yine bulunduÄŸunuz dizin ve verdiÄŸiniz servis adÄ±nÄ± harmanlayarak bir isim (Ã¶r: dockercomposedemo_api) oluÅŸturulacaktÄ±r.\nports YML dosya biÃ§iminde â€œ-â€ ile baÅŸlayan kÄ±sÄ±mlar Ã¼stÃ¼ndeki satÄ±rÄ± dizi (array) olarak tanÄ±mlar. Yani birden fazla â€œ-â€ ile baÅŸlayan satÄ±r yazarak, ports dizisine birden Ã§ok eriÅŸim noktasÄ± (port) ekleyebilirsiniz. Bizim Ã¶rneÄŸimiz iÃ§in konuÅŸursak; ev sahibi (host) makinedeki 8080. eriÅŸim noktasÄ±nÄ±, container iÃ§erisindeki 8080 numaralÄ± eriÅŸim noktasÄ±na baÄŸlÄ±yoruz.\nBir eriÅŸim noktasÄ±, ev sahibi makinede yalnÄ±zca 1 kez kullanÄ±labilir. Bu nedenle herhangi bir servisi, aynÄ± ev sahibi makinede birden fazla kez Ã§alÄ±ÅŸtÄ±rmayÄ± dÃ¼ÅŸÃ¼nÃ¼yorsanÄ±z bu kÄ±sÄ±mda yalnÄ±zca containerâ€™a ait olan eriÅŸim noktasÄ±nÄ± belirtmelisiniz. Bu durumda, Compose containerâ€™Ä±nÄ±za ev sahibi makineden rastgele bir eriÅŸim noktasÄ± atar.\nlinks AltÄ±ndaki tanÄ±mdan anlayacaÄŸÄ±nÄ±z Ã¼zere, â€œlinksâ€ de bir dizi olup birden Ã§ok tanÄ±mlama kabul edebilir. Bir container, diÄŸerine eriÅŸeceÄŸinde bunun en kolay yolu bu containerâ€™larÄ± birbirine baÄŸlamaktÄ±r. YazÄ±m ÅŸekline bakarsak â€œ:â€ karakterinin solundaki servis adÄ±, saÄŸÄ±ndakiyse takma addÄ±r. Container iÃ§inden veritabanÄ±na ulaÅŸacaÄŸÄ±mÄ±zda bu takma adÄ± kullanÄ±yor olacaÄŸÄ±z. Bu, bizi gereksiz yere IP tanÄ±mlamaktan kurtacaktÄ±r. Proje iÃ§erisindeki application.yml dosyasÄ±na bakarsanÄ±z MySQL iÃ§in kullandÄ±ÄŸÄ±mÄ±z baÄŸlantÄ± cÃ¼mlesinde (connection string) takma ad olan demodb kelimesini kullandÄ±ÄŸÄ±mÄ±zÄ± gÃ¶rebilirsiniz. Takma ad kullanmanÄ±n avantajÄ±; servis adÄ± deÄŸiÅŸse bile takma adÄ±n deÄŸiÅŸmemesidir. BÃ¶ylece kodumuzda deÄŸiÅŸiklik yapmak zorunda kalmÄ±yoruz.\nSwarm modunda bu parametre gÃ¶zardÄ± edilmektedir.\ncommand Container baÅŸlatÄ±lÄ±rken Ã§alÄ±ÅŸtÄ±rÄ±lacak komutun ne olacaÄŸÄ±nÄ± belirler.\nSerinin Ã¶nceki yazÄ±larÄ±nda bahsettiÄŸim gibi, bu tanÄ±m aslÄ±nda Dockerfile iÃ§inde de yapÄ±labiliyor. Burada tekrar yapma sebebim, Composeâ€™un yapÄ±sÄ±ndan kaynaklanÄ±yor. Tahmin edebileceÄŸiniz gibi MySQL baÅŸlayana kadar DB containerâ€™Ä±ndaki 3306 eriÅŸim noktasÄ± aÃ§Ä±k deÄŸil. Bu durumda uygulamam ayaÄŸa kalkarken baÄŸlanamayÄ±p hata verecektir. Bunu engellemek iÃ§in eriÅŸim noktasÄ±nÄ± sÃ¼rekli yoklayÄ±p aÃ§Ä±lÄ±nca uygulamayÄ± baÅŸlatan wait-for-it.sh adÄ±nda bir betik (script) kullanÄ±yorum.\nenvironment Ä°maj iÃ§erisinde tanÄ±mlÄ± olan Ã§evresel deÄŸiÅŸkenleri, yeni bir container baÅŸlatÄ±rken bu ÅŸekilde deÄŸiÅŸtirebiliyor, tanÄ±mlayabiliyorsunuz. DB servisi iÃ§in belirttiÄŸim deÄŸiÅŸkenler, container ayaÄŸa kalktÄ±ÄŸÄ±nda Ã§alÄ±ÅŸan betiÄŸin, benim istediÄŸim isimle bir veritabanÄ± yaratmasÄ±nÄ± ve yine istediÄŸim kullanÄ±cÄ± adÄ± ve ÅŸifreyle Ã§alÄ±ÅŸmasÄ±nÄ± saÄŸlÄ±yor.\nYalnÄ±zca 20 satÄ±rlÄ±k bu docker-compose.yml dosyasÄ±yla API containerâ€™Ä±nÄ±n imajÄ±nÄ±n yaratÄ±lmasÄ±nÄ±, ondan da bir container ayaÄŸa kaldÄ±rÄ±lmasÄ±nÄ± ve MySQL imajÄ±ndan DB adÄ±nda bir container yaratÄ±lmasÄ±nÄ± saÄŸlayabiliyorsunuz. Tabii ki yapabilecekleriniz bunlarla sÄ±nÄ±rlÄ± deÄŸil. EkleyebileceÄŸiniz diÄŸer parametrelerle container kayÄ±tlarÄ±nÄ±n nereye yazÄ±lacaÄŸÄ±nÄ±, container yÃ¼kleme (deployment) stratejilerinin belirlenmesini, baÄŸlanacak dosya/dizinleri ve daha pek Ã§ok ayarÄ± yapabilirsiniz.\nSerinin ilerleyen bÃ¶lÃ¼mlerinde farklÄ± proje Ã¶rneklerinde Composeâ€™u nasÄ±l kullanabileceÄŸinizi iÅŸliyor olacaÄŸÄ±m.\nCompose ile Ã‡alÄ±ÅŸmak YML dosyasÄ±nÄ± inceledikten sonra sÄ±ra geldi containerâ€™larÄ±mÄ±zÄ± Ã§alÄ±ÅŸtÄ±rmaya! Bunun iÃ§in YML dosyasÄ±nÄ±n bulunduÄŸu dizine gidin ve ÅŸu komutu Ã§alÄ±ÅŸtÄ±rÄ±n:\ndocker-compose up -d Bu komut containerâ€™larÄ± yaratacak, servisleri baÅŸlatacak ve sonrasÄ±nda da Ã§Ä±kÄ±ÅŸ yapacak. -d ya da uzun haliyle --daemon parametresi, komutun arka planda (daemon) Ã§alÄ±ÅŸmasÄ±nÄ± saÄŸlar. Ã‡alÄ±ÅŸtÄ±klarÄ±nÄ± da teyid edelim:\ndocker-compose ps\nDikkat ederseniz API servisimizin eriÅŸim noktasÄ± (8080) dÄ±ÅŸarÄ±ya aÃ§Ä±k ve eriÅŸilebilir durumdayken, DB servisimiz iÃ§in aynÄ± durum geÃ§erli deÄŸil. Bunun sebebi, Composeâ€™un YML dosyasÄ±nda bu eriÅŸim noktasÄ±nÄ± aÃ§mamÄ±ÅŸ olmamÄ±zdan kaynaklanÄ±yor. EÄŸer veritabanÄ±nÄ±za dÄ±ÅŸarÄ±dan eriÅŸebilmek isterseniz dosyayÄ± deÄŸiÅŸtirip eriÅŸim noktasÄ±nÄ± aÃ§malÄ± ve servisleri yeniden ayaÄŸa kaldÄ±rmalÄ±sÄ±nÄ±z.\nEriÅŸim noktasÄ± aÃ§Ä±k olmamasÄ±na raÄŸmen, API servisi veritabanÄ±na baÄŸlanabiliyor Ã§Ã¼nkÃ¼ Compose containerâ€™larÄ±n kendi arasÄ±nda iletiÅŸimi iÃ§in Ã¶zel bir aÄŸ yarattÄ± ve yukarÄ±da bahsettiÄŸim gibi, DB servisinin IP adresi demodb adÄ±yla API servisine ait container tarafÄ±ndan ulaÅŸÄ±labilir durumda.\nComposeâ€™un yarattÄ±ÄŸÄ± bu aÄŸ, servislerin izolasyonu aÃ§Ä±sÄ±ndan oldukÃ§a Ã¶nemli. Serinin ilerleyen bÃ¶lÃ¼mlerinde gÃ¶receÄŸimiz Ã¼zere, YML dosyasÄ±nda yapacaÄŸÄ±nÄ±z bir takÄ±m deÄŸiÅŸikliklerle birden Ã§ok Compose YML dosyasÄ±yla yÃ¶nettiÄŸiniz servisleri aynÄ± aÄŸa baÄŸlamanÄ±z mÃ¼mkÃ¼n.\nArtÄ±k servisimiz ayakta olduÄŸuna gÃ¶re istek atÄ±p Ã¼stÃ¼nde Ã§alÄ±ÅŸabiliriz:\nSpring Boot ile yazÄ±lmÄ±ÅŸ HATEOAS REST API, DBâ€™den aldÄ±ÄŸÄ± sonuÃ§larÄ± dÃ¶nÃ¼yor.\ndocker-compose down komutunu vererek tÃ¼m servislerin kapatÄ±lmasÄ±nÄ± ve bunlara baÄŸlÄ± olarak yaratÄ±lmÄ±ÅŸ aÄŸ ile tÃ¼m containerâ€™larÄ±n silinmesini saÄŸlayabilirsiniz:\ndocker-compose down komut Ã§Ä±ktÄ±sÄ±\nKolaylÄ±k olmasÄ± aÃ§Ä±sÄ±ndan oluÅŸturulan imajlar silinmiyor. Bu sayede bir sonraki sefer docker-compose up -d komutunu verdiÄŸinizde servisleriniz Ã§ok daha hÄ±zlÄ± ayaÄŸa kaldÄ±rÄ±lÄ±r. EÄŸer imajlarÄ± da silmek isterseniz;\ndocker-compose down --rmi all komutunu verebilirsiniz.\nÄ°pucu #1 Diyelim ki; Ubuntu bazlÄ± bir Docker imajÄ±nÄ±z var ve her ayaÄŸa kalkÄ±ÅŸÄ±nda aÅŸaÄŸÄ±daki komutlarÄ± Ã§alÄ±ÅŸtÄ±rÄ±yor:\napt-get update apt-get upgrade Daha farklÄ± bir senaryo olarak, containerâ€™Ä±nÄ±z ayaÄŸa kalkarken bir betik Ã§alÄ±ÅŸtÄ±rarak git deponuzdaki kodun son halini de alÄ±yor olabilir Ã¶rneÄŸin. Bu gibi senaryolarda down komutuyla her ÅŸeyi kaldÄ±rmak yerine;\ndocker-compose stop komutuyla aÄŸÄ± ve tÃ¼m servisleri geÃ§ici olarak pasifize edebilir, ihtiyacÄ±nÄ±z olduÄŸunda da;\ndocker-compose start komutuyla yeniden baÅŸlatabilirsiniz.\nÄ°pucu #2 Klasik Docker komutlarÄ±ndan farklÄ± olarak Compose da logs, restart, rm, exec vb. pek Ã§ok komutu saÄŸlÄ±yor. BunlarÄ±n amaÃ§larÄ±nÄ± ve kullanÄ±m ÅŸekillerini Ã¶rneÄŸin;\ndocker-compose logs --help komutuyla gÃ¶rÃ¼ntÃ¼leyebilirsiniz.\nÄ°pucu #3 YukarÄ±daki Ã¶rnekte bir API servisi, bir de DB servisi Ã§alÄ±ÅŸtÄ±rmÄ±ÅŸtÄ±k. AÅŸaÄŸÄ±daki komutla istediÄŸiniz servisten, istediÄŸiniz adette baÅŸlatabilirsiniz:\ndocker-compose scale api=2 db=1 Tabii uygulamanÄ±zÄ±n da buna hazÄ±r olmasÄ± kaydÄ±yla! ğŸ˜‰\nBu bÃ¶lÃ¼mÃ¼nÃ¼n de sonuna geldik. Bir sonraki bÃ¶lÃ¼mde Docker Machine ve Docker Swarmâ€™dan bahsedeceÄŸim.\nGidiÅŸÃ¢ta gÃ¶re bu planda zaman zaman deÄŸiÅŸiklikler yapacak olsam da serinin tÃ¼m bÃ¶lÃ¼mlerinin planÄ±na ÅŸuradan ulaÅŸabilirsiniz.\n",
  "wordCount" : "1346",
  "inLanguage": "tr",
  "datePublished": "2017-03-20T00:00:00Z",
  "dateModified": "2021-04-26T00:02:59+03:00",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://alperkan.at/tr/2017/03/docker-serisi-4/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Alper Kanat",
    "logo": {
      "@type": "ImageObject",
      "url": "https://alperkan.at/favicon.ico"
    }
  }
}
</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><noscript><style type=text/css>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:#1d1e20;--entry:#2e2e33;--primary:rgba(255, 255, 255, 0.84);--secondary:rgba(255, 255, 255, 0.56);--tertiary:rgba(255, 255, 255, 0.16);--content:rgba(255, 255, 255, 0.74);--hljs-bg:#2e2e33;--code-bg:#37383e;--border:#333}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><header class=header><nav class=nav><div class=logo><a href=https://alperkan.at/tr/ accesskey=h title="Alper Kanat (Alt + H)">Alper Kanat</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li><li><a href=https://alperkan.at/ title=ğŸ‡¬ğŸ‡§ aria-label=ğŸ‡¬ğŸ‡§>En</a></li></ul></span></div><ul id=menu><li><a href=https://alperkan.at/tr/arsiv title=arÅŸiv><span>arÅŸiv</span></a></li><li><a href=https://alperkan.at/tr/tags title=etiketler><span>etiketler</span></a></li><li><a href=https://alperkan.at/tr/hakkimda title=hakkÄ±mda><span>hakkÄ±mda</span></a></li><li><a href=https://github.com/tunix/notebook title=notlarÄ±m><span>notlarÄ±m</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Docker Serisi #4 -- Docker Compose</h1><div class=post-meta>March 20, 2017</div></header><div class=post-content><ol start=4><li>bÃ¶lÃ¼me hoÅŸgeldiniz! ğŸ¤˜ğŸ» Serinin Ã¶nceki bÃ¶lÃ¼mlerine ulaÅŸmak iÃ§in aÅŸaÄŸÄ±daki baÄŸlantÄ±larÄ± kullanabilirsiniz:</li></ol><ul><li><a href=https://alperkan.at/tr/2016/07/docker-serisi-1/>Docker Serisi #1</a></li><li><a href=https://alperkan.at/tr/2016/09/docker-serisi-2/>Docker Serisi #2 â€” Docker Engine BÃ¶lÃ¼m 1</a></li><li><a href=https://alperkan.at/tr/2016/10/docker-serisi-3/>Docker Serisi #3 â€” Docker Engine BÃ¶lÃ¼m 2</a></li></ul><p>Daha Ã§ok geliÅŸtirme Ã¼stÃ¼ne duracak olsam da, <a href=https://docs.docker.com/compose/>Docker Compose</a>â€™u test ortamÄ± ya da
farklÄ± ihtiyaÃ§lar iÃ§in de kullanabilirsiniz. Ã–zellikle tek bir makine Ã¼stÃ¼nde birden fazla container ile Ã§alÄ±ÅŸmayÄ±
dÃ¼ÅŸÃ¼nÃ¼yorsanÄ±z <a href=https://docs.docker.com/compose/>Docker Compose</a> mutlaka incelemeniz gereken bir araÃ§!</p><p><strong>GÃ¼ncelleme:</strong> Docker 1.13 ile birlikte Docker Compose ile tanÄ±mladÄ±ÄŸÄ±nÄ±z bir projeyi
<a href=https://docs.docker.com/swarm/>Swarm</a> ile birden Ã§ok makineye daÄŸÄ±tabiliyorsunuz! ğŸ‰ Seride buna da yer vermek farz
oldu tabii ki!</p><p>Ã–zetle; uygulamanÄ±zÄ±, projenize yerleÅŸtireceÄŸiniz <code>docker-compose.yml</code> adÄ±nda bir dosya aracÄ±lÄ±ÄŸÄ±yla servisler olarak
tanÄ±mlamanÄ±za olanak tanÄ±r ve Ã§alÄ±ÅŸtÄ±rdÄ±ÄŸÄ±nÄ±zda ilgili containerâ€™larÄ±, disk bÃ¶lÃ¼mlerini, aÄŸlarÄ± vb. her ÅŸeyi oluÅŸturup
iÅŸiniz bittiÄŸinde de tamamen kaldÄ±rÄ±r. O zaman kurulum ile hemen iÅŸe koyulalÄ±m! ğŸ˜Š</p><hr><h3 id=kurulum>Kurulum<a hidden class=anchor aria-hidden=true href=#kurulum>#</a></h3><p>Kurulum iÃ§in <a href=https://docs.docker.com/compose/install/>ÅŸuradaki</a> dÃ¶kÃ¼manÄ± takip edebilirsiniz. macOS ve brew
kullanÄ±yorsanÄ±z;</p><pre tabindex=0><code>brew install docker-compose
</code></pre><p>komutuyla kurulumu tamamlayabilirsiniz. EÄŸer makinenizde Python (pip >= 6.0) kullanÄ±yorsanÄ±z;</p><pre tabindex=0><code>pip install docker-compose
</code></pre><p>komutunu kullanabilirsiniz. Alternatif olarak aÅŸaÄŸÄ±daki komutlar ile de kurulumu gerÃ§ekleÅŸtirebilirsiniz:</p><pre tabindex=0><code># curl -L https://github.com/docker/compose/releases/download/1.9.0/docker-compose-`uname -s`-`uname -m` &gt; /usr/local/bin/docker-compose
# chmod +x /usr/local/bin/docker-compose
</code></pre><p>Kurulumu baÅŸarÄ±yla tamamladÄ±ysanÄ±z aÅŸaÄŸÄ±daki gibi sÃ¼rÃ¼m numarasÄ± Ã§Ä±ktÄ±sÄ±nÄ± gÃ¶rebilmelisiniz:</p><pre tabindex=0><code>$ docker-compose --version
docker-compose version 1.11.2, build dfed245
</code></pre><hr><blockquote><p>YazÄ±nÄ±n bundan sonraki bÃ¶lÃ¼mÃ¼nde <a href=https://github.com/tunix/docker-compose-demo>ÅŸu adreste</a> bulabileceÄŸiniz Ã¶rnek
projeyi kullanarak devam edeceÄŸim. Dilerseniz indirip benimle beraber adÄ±mlarÄ± tekrarlayabilir ve denemeler
yapabilirsiniz.</p></blockquote><hr><h3 id=docker-composeyml>docker-compose.yml<a hidden class=anchor aria-hidden=true href=#docker-composeyml>#</a></h3><p>Normalde projenizin ana dizinine tek bir <code>docker-compose.yml</code> dosyasÄ± koymak yeterli olmakla beraber, bir dizin birden
fazla alt projeye ev sahipliÄŸi yapÄ±yorsa bu durumda alt dizinlere de birer tane <code>docker-compose.yml</code> dosyasÄ±
yerleÅŸtirebilirsiniz. Bu durumda <code>-f</code> parametresiyle dosya yolunu belirtmelisiniz.</p><p>DosyanÄ±n biÃ§imi, kullanÄ±labilecek anahtar kelimeler vb. iÃ§in <a href=https://docs.docker.com/compose/compose-file/>ÅŸuradaki</a>
belgeyi inceleyebilirsiniz. Klasik bir <code>docker-compose.yml</code> dosyasÄ± yaklaÅŸÄ±k olarak aÅŸaÄŸÄ±daki gibidir:</p><script type=application/javascript src=https://gist.github.com/tunix/15a0a926b3a16c6acb8ffbd75351fbf0.js></script><p>YML dosyasÄ± yazarken, bu dosya biÃ§imine has yazÄ±m kurallarÄ±na dikkat etmelisiniz. KapsamÄ± iyice geniÅŸletmemek adÄ±na
yazÄ±m kurallarÄ±na girmeyeceÄŸim ancak Ã¶zellikle girintilemeye Ã¶zen gÃ¶stermelisiniz.</p><p>Ä°lk satÄ±r dosyanÄ±n biÃ§imlendirmesinde kullanÄ±lan tanÄ±mlamalarÄ±n (spec) sÃ¼rÃ¼mÃ¼nÃ¼ belirtiyor ve ilk satÄ±rda olma
zorunluluÄŸu var. Docker 1.13 Ã¶ncesinde sÃ¼rÃ¼m numarasÄ± olarak yalnÄ±zca &ldquo;2&rdquo; kullanÄ±lÄ±rken, artÄ±k &ldquo;3&rdquo; de kullanÄ±labiliyor.
SÃ¼rÃ¼m numarasÄ±, dosyanÄ±n biÃ§iminde yapÄ±labilecek deÄŸiÅŸikliklerden etkilenilmemesi iÃ§in dÃ¼ÅŸÃ¼nÃ¼lmÃ¼ÅŸ bir Ã¶zellik. Yani
eski bir projenizde sÃ¼rÃ¼m olarak &ldquo;2&rdquo; kullanÄ±yorsanÄ±z, artÄ±k desteklenmeyen bir Docker sÃ¼rÃ¼mÃ¼ kullanmÄ±yorsanÄ±z, projeniz
olduÄŸu gibi Ã§alÄ±ÅŸacaktÄ±r. Yeni bir projeye baÅŸladÄ±ÄŸÄ±nÄ±zda sÃ¼rÃ¼mÃ¼ &ldquo;3&rdquo; olarak belirtmeli ve yazÄ±m kurallarÄ±nÄ± da bu
sÃ¼rÃ¼me uyacak ÅŸekilde uygulamalÄ±sÄ±nÄ±z.</p><p>Dosyada tanÄ±mlamanÄ±z gereken ikinci kÄ±sÄ±m: servisler. Her bir servisi, ayrÄ± birer container gibi dÃ¼ÅŸÃ¼nebilirsiniz.
&ldquo;services&rdquo; kelimesinin altÄ±nda, 1 girintileme ile ayÄ±rdÄ±ÄŸÄ±nÄ±z her ÅŸey bir servistir ve Ã§alÄ±ÅŸacak container&rsquo;Ä±n adÄ±
burada yazdÄ±ÄŸÄ±nÄ±z kelimeyle anÄ±lacaktÄ±r.</p><p>Ä°lk servisimiz adÄ±ndan da anlaÅŸÄ±labileceÄŸi gibi API hizmeti sunan bir containerâ€™dan ibaret. AynÄ± servisten birden Ã§ok
kez baÅŸlatma ihtimaline karÅŸÄ±lÄ±k Compose, yazdÄ±ÄŸÄ±nÄ±z ismi, YML dosyasÄ±nÄ±n bulunduÄŸu dizin adÄ± ve bir rakamla
harmanlayÄ±p container adÄ± (Ã¶r: <code>dockercomposedemo_api_1</code>) yaratÄ±r. YalnÄ±zca tek bir container baÅŸlatacaÄŸÄ±nÄ±zdan
eminseniz servis tanÄ±mlarÄ±na</p><pre tabindex=0><code>container_name: demo-api
</code></pre><p>yazarak bu isimle aÃ§Ä±lmasÄ±nÄ± <a href=https://docs.docker.com/compose/compose-file/#containername>saÄŸlayabilirsiniz</a>. Bu
durumda birden fazla container baÅŸlatmaya Ã§alÄ±ÅŸÄ±rsanÄ±z hata alÄ±rsÄ±nÄ±z.</p><p>Servisimizin adÄ±nÄ±n altÄ±nda bir kez daha girintileme ile yazdÄ±ÄŸÄ±mÄ±z her ÅŸey servisi tanÄ±mlayan ayarlar olarak
algÄ±lanÄ±r. Åimdi gelin; sÄ±rasÄ±yla yazdÄ±klarÄ±mÄ±zÄ± anlamaya Ã§alÄ±ÅŸalÄ±m:</p><h4 id=build->build: .<a hidden class=anchor aria-hidden=true href=#build->#</a></h4><p>KÄ±saca imajÄ± oluÅŸturulacak Dockerfile dosyasÄ±nÄ±n yerini (build context) belirtmek iÃ§in kullanÄ±lÄ±r. Bizim projemizde
Dockerfile, YML dosyasÄ±yla aynÄ± dizinde bulunduÄŸu iÃ§in &ldquo;.&rdquo; (nokta) ile bu dizini iÅŸaret ediyoruz. Dilerseniz farklÄ± bir
dizindeki Dockerfileâ€™Ä± iÅŸaret edebilir, Dockerfile yerine farklÄ± bir isim kullanÄ±yorsanÄ±z ya da imajÄ± yaratabilmek iÃ§in
ek parametrelere ihtiyaÃ§ duyuyorsanÄ±z bunlarÄ± da bu kÄ±sÄ±mda belirtebilirsiniz. Detaylar iÃ§in
<a href=https://docs.docker.com/compose/compose-file/#build>tÄ±k tÄ±k</a>.</p><p><a href=https://docs.docker.com/swarm/>Swarm</a> modunda bu parametre gÃ¶zardÄ± edilmekte ve bir alttaki image parametresi
kullanÄ±lmaktadÄ±r.</p><h4 id=image-tunixdocker-compose-demo>image: tunix/docker-compose-demo<a hidden class=anchor aria-hidden=true href=#image-tunixdocker-compose-demo>#</a></h4><p>Ä°majÄ±n derlenmesi sonucunda Ã§Ä±kacak Docker imajÄ±nÄ±n adÄ±nÄ± bu komutla belirtiyoruz. HiÃ§ bir ÅŸey yazmazsanÄ±z yine
bulunduÄŸunuz dizin ve verdiÄŸiniz servis adÄ±nÄ± harmanlayarak bir isim (Ã¶r: <code>dockercomposedemo_api</code>) oluÅŸturulacaktÄ±r.</p><h4 id=ports>ports<a hidden class=anchor aria-hidden=true href=#ports>#</a></h4><p>YML dosya biÃ§iminde &ldquo;-&rdquo; ile baÅŸlayan kÄ±sÄ±mlar Ã¼stÃ¼ndeki satÄ±rÄ± dizi (array) olarak tanÄ±mlar. Yani birden fazla &ldquo;-&rdquo; ile
baÅŸlayan satÄ±r yazarak, ports dizisine birden Ã§ok eriÅŸim noktasÄ± (port) ekleyebilirsiniz. Bizim Ã¶rneÄŸimiz iÃ§in
konuÅŸursak; ev sahibi (host) makinedeki 8080. eriÅŸim noktasÄ±nÄ±, container iÃ§erisindeki 8080 numaralÄ± eriÅŸim noktasÄ±na
baÄŸlÄ±yoruz.</p><p>Bir eriÅŸim noktasÄ±, ev sahibi makinede yalnÄ±zca 1 kez kullanÄ±labilir. Bu nedenle herhangi bir servisi, aynÄ± ev sahibi
makinede birden fazla kez Ã§alÄ±ÅŸtÄ±rmayÄ± dÃ¼ÅŸÃ¼nÃ¼yorsanÄ±z bu kÄ±sÄ±mda yalnÄ±zca containerâ€™a ait olan eriÅŸim noktasÄ±nÄ±
belirtmelisiniz. Bu durumda, Compose containerâ€™Ä±nÄ±za ev sahibi makineden rastgele bir eriÅŸim noktasÄ± atar.</p><h4 id=links>links<a hidden class=anchor aria-hidden=true href=#links>#</a></h4><p>AltÄ±ndaki tanÄ±mdan anlayacaÄŸÄ±nÄ±z Ã¼zere, &ldquo;links&rdquo; de bir dizi olup birden Ã§ok tanÄ±mlama
<a href=https://docs.docker.com/compose/compose-file/#links>kabul edebilir</a>. Bir container, diÄŸerine eriÅŸeceÄŸinde bunun en
kolay yolu bu containerâ€™larÄ± birbirine baÄŸlamaktÄ±r. YazÄ±m ÅŸekline bakarsak &ldquo;:&rdquo; karakterinin solundaki servis adÄ±,
saÄŸÄ±ndakiyse takma addÄ±r. Container iÃ§inden veritabanÄ±na ulaÅŸacaÄŸÄ±mÄ±zda bu takma adÄ± kullanÄ±yor olacaÄŸÄ±z. Bu, bizi
gereksiz yere IP tanÄ±mlamaktan kurtacaktÄ±r. Proje iÃ§erisindeki
<a href=https://github.com/tunix/docker-compose-demo/blob/master/src/main/resources/application.yml>application.yml</a>
dosyasÄ±na bakarsanÄ±z MySQL iÃ§in kullandÄ±ÄŸÄ±mÄ±z baÄŸlantÄ± cÃ¼mlesinde (connection string) takma ad olan <code>demodb</code> kelimesini
kullandÄ±ÄŸÄ±mÄ±zÄ± gÃ¶rebilirsiniz. Takma ad kullanmanÄ±n avantajÄ±; servis adÄ± deÄŸiÅŸse bile takma adÄ±n deÄŸiÅŸmemesidir.
BÃ¶ylece kodumuzda deÄŸiÅŸiklik yapmak zorunda kalmÄ±yoruz.</p><p><a href=https://docs.docker.com/swarm/>Swarm</a> modunda bu parametre gÃ¶zardÄ± edilmektedir.</p><h4 id=command>command<a hidden class=anchor aria-hidden=true href=#command>#</a></h4><p>Container baÅŸlatÄ±lÄ±rken Ã§alÄ±ÅŸtÄ±rÄ±lacak komutun ne olacaÄŸÄ±nÄ± belirler.</p><p>Serinin Ã¶nceki yazÄ±larÄ±nda <a href=https://alperkan.at/tr/2016/10/docker-serisi-3/>bahsettiÄŸim</a> gibi, bu tanÄ±m aslÄ±nda Dockerfile iÃ§inde de
yapÄ±labiliyor. Burada tekrar yapma sebebim, Composeâ€™un yapÄ±sÄ±ndan kaynaklanÄ±yor. Tahmin edebileceÄŸiniz gibi MySQL
baÅŸlayana kadar DB containerâ€™Ä±ndaki 3306 eriÅŸim noktasÄ± aÃ§Ä±k deÄŸil. Bu durumda uygulamam ayaÄŸa kalkarken baÄŸlanamayÄ±p
hata verecektir. Bunu engellemek iÃ§in eriÅŸim noktasÄ±nÄ± sÃ¼rekli yoklayÄ±p aÃ§Ä±lÄ±nca uygulamayÄ± baÅŸlatan
<a href=https://github.com/tunix/docker-compose-demo/blob/master/wait-for-it.sh>wait-for-it.sh</a> adÄ±nda bir betik (script)
kullanÄ±yorum.</p><h4 id=environment>environment<a hidden class=anchor aria-hidden=true href=#environment>#</a></h4><p>Ä°maj iÃ§erisinde tanÄ±mlÄ± olan Ã§evresel deÄŸiÅŸkenleri, yeni bir container baÅŸlatÄ±rken bu ÅŸekilde deÄŸiÅŸtirebiliyor,
tanÄ±mlayabiliyorsunuz. DB servisi iÃ§in belirttiÄŸim deÄŸiÅŸkenler, container ayaÄŸa kalktÄ±ÄŸÄ±nda Ã§alÄ±ÅŸan betiÄŸin, benim
istediÄŸim isimle bir veritabanÄ± yaratmasÄ±nÄ± ve yine istediÄŸim kullanÄ±cÄ± adÄ± ve ÅŸifreyle Ã§alÄ±ÅŸmasÄ±nÄ± saÄŸlÄ±yor.</p><p>YalnÄ±zca 20 satÄ±rlÄ±k bu
<a href=https://github.com/tunix/docker-compose-demo/blob/master/docker-compose.yml>docker-compose.yml</a> dosyasÄ±yla API
containerâ€™Ä±nÄ±n imajÄ±nÄ±n yaratÄ±lmasÄ±nÄ±, ondan da bir container ayaÄŸa kaldÄ±rÄ±lmasÄ±nÄ± ve MySQL imajÄ±ndan DB adÄ±nda bir
container yaratÄ±lmasÄ±nÄ± saÄŸlayabiliyorsunuz. Tabii ki yapabilecekleriniz bunlarla sÄ±nÄ±rlÄ± deÄŸil.
<a href=https://docs.docker.com/compose/compose-file/>EkleyebileceÄŸiniz diÄŸer parametrelerle</a> container kayÄ±tlarÄ±nÄ±n nereye
yazÄ±lacaÄŸÄ±nÄ±, container yÃ¼kleme (deployment) stratejilerinin belirlenmesini, baÄŸlanacak dosya/dizinleri ve daha pek Ã§ok
ayarÄ± yapabilirsiniz.</p><p>Serinin ilerleyen bÃ¶lÃ¼mlerinde farklÄ± proje Ã¶rneklerinde Composeâ€™u nasÄ±l kullanabileceÄŸinizi iÅŸliyor olacaÄŸÄ±m.</p><h3 id=compose-ile-Ã§alÄ±ÅŸmak>Compose ile Ã‡alÄ±ÅŸmak<a hidden class=anchor aria-hidden=true href=#compose-ile-Ã§alÄ±ÅŸmak>#</a></h3><p>YML dosyasÄ±nÄ± inceledikten sonra sÄ±ra geldi containerâ€™larÄ±mÄ±zÄ± Ã§alÄ±ÅŸtÄ±rmaya! Bunun iÃ§in YML dosyasÄ±nÄ±n bulunduÄŸu dizine
gidin ve ÅŸu komutu Ã§alÄ±ÅŸtÄ±rÄ±n:</p><pre tabindex=0><code>docker-compose up -d
</code></pre><p>Bu komut containerâ€™larÄ± yaratacak, servisleri baÅŸlatacak ve sonrasÄ±nda da Ã§Ä±kÄ±ÅŸ yapacak. <code>-d</code> ya da uzun haliyle
<code>--daemon</code> parametresi, komutun arka planda (daemon) Ã§alÄ±ÅŸmasÄ±nÄ± saÄŸlar. Ã‡alÄ±ÅŸtÄ±klarÄ±nÄ± da teyid edelim:</p><figure><img loading=lazy src=docker_compose_ps_ciktisi.png alt="docker-compose ps"><figcaption><p>docker-compose ps</p></figcaption></figure><p>Dikkat ederseniz API servisimizin eriÅŸim noktasÄ± (8080) dÄ±ÅŸarÄ±ya aÃ§Ä±k ve eriÅŸilebilir durumdayken, DB servisimiz iÃ§in
aynÄ± durum geÃ§erli deÄŸil. Bunun sebebi, Composeâ€™un YML dosyasÄ±nda bu eriÅŸim noktasÄ±nÄ± aÃ§mamÄ±ÅŸ olmamÄ±zdan kaynaklanÄ±yor.
EÄŸer veritabanÄ±nÄ±za dÄ±ÅŸarÄ±dan eriÅŸebilmek isterseniz dosyayÄ± deÄŸiÅŸtirip eriÅŸim noktasÄ±nÄ± aÃ§malÄ± ve servisleri yeniden
ayaÄŸa kaldÄ±rmalÄ±sÄ±nÄ±z.</p><p>EriÅŸim noktasÄ± aÃ§Ä±k olmamasÄ±na raÄŸmen, API servisi veritabanÄ±na baÄŸlanabiliyor Ã§Ã¼nkÃ¼ Compose containerâ€™larÄ±n kendi
arasÄ±nda iletiÅŸimi iÃ§in Ã¶zel bir aÄŸ yarattÄ± ve yukarÄ±da bahsettiÄŸim gibi, DB servisinin IP adresi <code>demodb</code> adÄ±yla API
servisine ait container tarafÄ±ndan ulaÅŸÄ±labilir durumda.</p><p>Composeâ€™un yarattÄ±ÄŸÄ± bu aÄŸ, servislerin izolasyonu aÃ§Ä±sÄ±ndan oldukÃ§a Ã¶nemli. Serinin ilerleyen bÃ¶lÃ¼mlerinde gÃ¶receÄŸimiz
Ã¼zere, YML dosyasÄ±nda yapacaÄŸÄ±nÄ±z bir takÄ±m deÄŸiÅŸikliklerle birden Ã§ok Compose YML dosyasÄ±yla yÃ¶nettiÄŸiniz servisleri
aynÄ± aÄŸa baÄŸlamanÄ±z mÃ¼mkÃ¼n.</p><p>ArtÄ±k servisimiz ayakta olduÄŸuna gÃ¶re istek atÄ±p Ã¼stÃ¼nde Ã§alÄ±ÅŸabiliriz:</p><figure><img loading=lazy src=servis_istek_ciktisi.png alt="Spring Boot ile yazÄ±lmÄ±ÅŸ HATEOAS REST API, DBâ€™den aldÄ±ÄŸÄ± sonuÃ§larÄ± dÃ¶nÃ¼yor."><figcaption><p>Spring Boot ile yazÄ±lmÄ±ÅŸ HATEOAS REST API, DBâ€™den aldÄ±ÄŸÄ± sonuÃ§larÄ± dÃ¶nÃ¼yor.</p></figcaption></figure><pre tabindex=0><code>docker-compose down
</code></pre><p>komutunu vererek tÃ¼m servislerin kapatÄ±lmasÄ±nÄ± ve bunlara baÄŸlÄ± olarak yaratÄ±lmÄ±ÅŸ aÄŸ ile tÃ¼m containerâ€™larÄ±n
silinmesini saÄŸlayabilirsiniz:</p><figure><img loading=lazy src=docker_compose_down_ciktisi.png alt="docker-compose down komut Ã§Ä±ktÄ±sÄ±"><figcaption><p>docker-compose down komut Ã§Ä±ktÄ±sÄ±</p></figcaption></figure><p>KolaylÄ±k olmasÄ± aÃ§Ä±sÄ±ndan oluÅŸturulan imajlar silinmiyor. Bu sayede bir sonraki sefer <code>docker-compose up -</code>d komutunu
verdiÄŸinizde servisleriniz Ã§ok daha hÄ±zlÄ± ayaÄŸa kaldÄ±rÄ±lÄ±r. EÄŸer imajlarÄ± da silmek isterseniz;</p><pre tabindex=0><code>docker-compose down --rmi all
</code></pre><p>komutunu verebilirsiniz.</p><h3 id=ipucu-1>Ä°pucu #1<a hidden class=anchor aria-hidden=true href=#ipucu-1>#</a></h3><p>Diyelim ki; Ubuntu bazlÄ± bir Docker imajÄ±nÄ±z var ve her ayaÄŸa kalkÄ±ÅŸÄ±nda aÅŸaÄŸÄ±daki komutlarÄ± Ã§alÄ±ÅŸtÄ±rÄ±yor:</p><pre tabindex=0><code>apt-get update
apt-get upgrade
</code></pre><p>Daha farklÄ± bir senaryo olarak, containerâ€™Ä±nÄ±z ayaÄŸa kalkarken bir betik Ã§alÄ±ÅŸtÄ±rarak git deponuzdaki kodun son halini
de alÄ±yor olabilir Ã¶rneÄŸin. Bu gibi senaryolarda down komutuyla her ÅŸeyi kaldÄ±rmak yerine;</p><pre tabindex=0><code>docker-compose stop
</code></pre><p>komutuyla aÄŸÄ± ve tÃ¼m servisleri geÃ§ici olarak pasifize edebilir, ihtiyacÄ±nÄ±z olduÄŸunda da;</p><pre tabindex=0><code>docker-compose start
</code></pre><p>komutuyla yeniden baÅŸlatabilirsiniz.</p><h3 id=ipucu-2>Ä°pucu #2<a hidden class=anchor aria-hidden=true href=#ipucu-2>#</a></h3><p>Klasik Docker komutlarÄ±ndan farklÄ± olarak Compose da <code>logs</code>, <code>restart</code>, <code>rm</code>, <code>exec</code> vb. pek Ã§ok komutu saÄŸlÄ±yor.
BunlarÄ±n amaÃ§larÄ±nÄ± ve kullanÄ±m ÅŸekillerini Ã¶rneÄŸin;</p><pre tabindex=0><code>docker-compose logs --help
</code></pre><p>komutuyla gÃ¶rÃ¼ntÃ¼leyebilirsiniz.</p><h3 id=ipucu-3>Ä°pucu #3<a hidden class=anchor aria-hidden=true href=#ipucu-3>#</a></h3><p>YukarÄ±daki Ã¶rnekte bir API servisi, bir de DB servisi Ã§alÄ±ÅŸtÄ±rmÄ±ÅŸtÄ±k. AÅŸaÄŸÄ±daki komutla istediÄŸiniz servisten, istediÄŸiniz adette baÅŸlatabilirsiniz:</p><pre tabindex=0><code>docker-compose scale api=2 db=1
</code></pre><p>Tabii uygulamanÄ±zÄ±n da buna hazÄ±r olmasÄ± kaydÄ±yla! ğŸ˜‰</p><figure><img loading=lazy src=docker_compose_scale_ciktisi.png></figure><hr><p>Bu bÃ¶lÃ¼mÃ¼nÃ¼n de sonuna geldik. Bir sonraki bÃ¶lÃ¼mde <a href=https://docs.docker.com/machine/>Docker Machine</a> ve
<a href=https://docs.docker.com/swarm/>Docker Swarm</a>â€™dan bahsedeceÄŸim.</p><p>GidiÅŸÃ¢ta gÃ¶re bu planda zaman zaman deÄŸiÅŸiklikler yapacak olsam da serinin tÃ¼m bÃ¶lÃ¼mlerinin planÄ±na
<a href=https://www.evernote.com/l/AB7CctYtJkpMUJsae1_3FgzIXgMY5MvFQhU>ÅŸuradan</a> ulaÅŸabilirsiniz.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://alperkan.at/tr/tags/yaz%C4%B1l%C4%B1m/>yazÄ±lÄ±m</a></li><li><a href=https://alperkan.at/tr/tags/docker/>docker</a></li><li><a href=https://alperkan.at/tr/tags/docker-serisi/>docker serisi</a></li><li><a href=https://alperkan.at/tr/tags/container/>container</a></li><li><a href=https://alperkan.at/tr/tags/sanalla%C5%9Ft%C4%B1rma/>sanallaÅŸtÄ±rma</a></li><li><a href=https://alperkan.at/tr/tags/linux/>linux</a></li><li><a href=https://alperkan.at/tr/tags/devops/>devops</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2022 <a href=https://alperkan.at/tr/>Alper Kanat</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)"><button class=top-link id=top-link type=button accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></button></a>
<script>let menu=document.getElementById("menu");menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)},document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>
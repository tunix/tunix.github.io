<!doctype html><html lang=tr dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Docker Serisi #5 -- Docker Machine & Swarm BÃ¶lÃ¼m 1 | Alper Kanat</title><meta name=keywords content="yazÄ±lÄ±m,docker,docker serisi,container,sanallaÅŸtÄ±rma,linux,devops"><meta name=description content="bÃ¶lÃ¼me hoÅŸgeldiniz! ğŸ¤˜ğŸ» Serinin Ã¶nceki bÃ¶lÃ¼mlerine ulaÅŸmak iÃ§in aÅŸaÄŸÄ±daki baÄŸlantÄ±larÄ± kullanabilirsiniz: Docker Serisi #1 Docker Serisi #2 â€” Docker Engine BÃ¶lÃ¼m 1 Docker Serisi #3 â€” Docker Engine BÃ¶lÃ¼m 2 Docker Serisi #4 â€” Docker Compose Serinin bu bÃ¶lÃ¼mÃ¼nde Docker Machineâ€™den ve teknoloji camiasÄ±nÄ±n bu sÄ±ralar Ã§ok sÄ±k duyduÄŸu Docker Swarmâ€™dan bahsedeceÄŸim. Swarm konusu derya deniz olduÄŸundan konuyu 2 ayrÄ± bÃ¶lÃ¼m halinde iÅŸleyeceÄŸim. Ä°lk bÃ¶lÃ¼mde Docker Machineâ€™den bahsedip Swarmâ€™a giriÅŸ yapacaÄŸÄ±z."><meta name=author content><link rel=canonical href=https://alperkan.at/tr/2017/10/docker-serisi-5/><link crossorigin=anonymous href=/assets/css/stylesheet.min.2d6dbfc6e0f8a1db1c9d082a76dc11d094328cf63f247bbc2421dfaa7f2bb170.css integrity="sha256-LW2/xuD4odscnQgqdtwR0JQyjPY/JHu8JCHfqn8rsXA=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.min.b95bacdc39e37a332a9f883b1e78be4abc1fdca2bc1f2641f55e3cd3dabd4d61.js integrity="sha256-uVus3DnjejMqn4g7Hni+Srwf3KK8HyZB9V4809q9TWE=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://alperkan.at/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://alperkan.at/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://alperkan.at/favicon-32x32.png><link rel=apple-touch-icon href=https://alperkan.at/apple-touch-icon.png><link rel=mask-icon href=https://alperkan.at/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.102.3"><link rel=alternate hreflang=tr href=https://alperkan.at/tr/2017/10/docker-serisi-5/><script async src="https://www.googletagmanager.com/gtag/js?id=G-SDT9Y68PM3"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-SDT9Y68PM3",{anonymize_ip:!1})}</script><meta property="og:title" content="Docker Serisi #5 -- Docker Machine & Swarm BÃ¶lÃ¼m 1"><meta property="og:description" content="bÃ¶lÃ¼me hoÅŸgeldiniz! ğŸ¤˜ğŸ» Serinin Ã¶nceki bÃ¶lÃ¼mlerine ulaÅŸmak iÃ§in aÅŸaÄŸÄ±daki baÄŸlantÄ±larÄ± kullanabilirsiniz: Docker Serisi #1 Docker Serisi #2 â€” Docker Engine BÃ¶lÃ¼m 1 Docker Serisi #3 â€” Docker Engine BÃ¶lÃ¼m 2 Docker Serisi #4 â€” Docker Compose Serinin bu bÃ¶lÃ¼mÃ¼nde Docker Machineâ€™den ve teknoloji camiasÄ±nÄ±n bu sÄ±ralar Ã§ok sÄ±k duyduÄŸu Docker Swarmâ€™dan bahsedeceÄŸim. Swarm konusu derya deniz olduÄŸundan konuyu 2 ayrÄ± bÃ¶lÃ¼m halinde iÅŸleyeceÄŸim. Ä°lk bÃ¶lÃ¼mde Docker Machineâ€™den bahsedip Swarmâ€™a giriÅŸ yapacaÄŸÄ±z."><meta property="og:type" content="article"><meta property="og:url" content="https://alperkan.at/tr/2017/10/docker-serisi-5/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2017-10-30T00:00:00+00:00"><meta property="article:modified_time" content="2021-04-26T00:02:59+03:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Docker Serisi #5 -- Docker Machine & Swarm BÃ¶lÃ¼m 1"><meta name=twitter:description content="bÃ¶lÃ¼me hoÅŸgeldiniz! ğŸ¤˜ğŸ» Serinin Ã¶nceki bÃ¶lÃ¼mlerine ulaÅŸmak iÃ§in aÅŸaÄŸÄ±daki baÄŸlantÄ±larÄ± kullanabilirsiniz: Docker Serisi #1 Docker Serisi #2 â€” Docker Engine BÃ¶lÃ¼m 1 Docker Serisi #3 â€” Docker Engine BÃ¶lÃ¼m 2 Docker Serisi #4 â€” Docker Compose Serinin bu bÃ¶lÃ¼mÃ¼nde Docker Machineâ€™den ve teknoloji camiasÄ±nÄ±n bu sÄ±ralar Ã§ok sÄ±k duyduÄŸu Docker Swarmâ€™dan bahsedeceÄŸim. Swarm konusu derya deniz olduÄŸundan konuyu 2 ayrÄ± bÃ¶lÃ¼m halinde iÅŸleyeceÄŸim. Ä°lk bÃ¶lÃ¼mde Docker Machineâ€™den bahsedip Swarmâ€™a giriÅŸ yapacaÄŸÄ±z."><script type=application/ld+json>
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://alperkan.at/tr/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Docker Serisi #5 -- Docker Machine \u0026 Swarm BÃ¶lÃ¼m 1",
      "item": "https://alperkan.at/tr/2017/10/docker-serisi-5/"
    }
  ]
}
</script><script type=application/ld+json>
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Docker Serisi #5 -- Docker Machine \u0026 Swarm BÃ¶lÃ¼m 1",
  "name": "Docker Serisi #5 -- Docker Machine \u0026 Swarm BÃ¶lÃ¼m 1",
  "description": "bÃ¶lÃ¼me hoÅŸgeldiniz! ğŸ¤˜ğŸ» Serinin Ã¶nceki bÃ¶lÃ¼mlerine ulaÅŸmak iÃ§in aÅŸaÄŸÄ±daki baÄŸlantÄ±larÄ± kullanabilirsiniz: Docker Serisi #1 Docker Serisi #2 â€” Docker Engine BÃ¶lÃ¼m 1 Docker Serisi #3 â€” Docker Engine BÃ¶lÃ¼m 2 Docker Serisi #4 â€” Docker Compose Serinin bu bÃ¶lÃ¼mÃ¼nde Docker Machineâ€™den ve teknoloji camiasÄ±nÄ±n bu sÄ±ralar Ã§ok sÄ±k duyduÄŸu Docker Swarmâ€™dan bahsedeceÄŸim. Swarm konusu derya deniz olduÄŸundan konuyu 2 ayrÄ± bÃ¶lÃ¼m halinde iÅŸleyeceÄŸim. Ä°lk bÃ¶lÃ¼mde Docker Machineâ€™den bahsedip Swarmâ€™a giriÅŸ yapacaÄŸÄ±z.",
  "keywords": [
    "yazÄ±lÄ±m", "docker", "docker serisi", "container", "sanallaÅŸtÄ±rma", "linux", "devops"
  ],
  "articleBody": " bÃ¶lÃ¼me hoÅŸgeldiniz! ğŸ¤˜ğŸ» Serinin Ã¶nceki bÃ¶lÃ¼mlerine ulaÅŸmak iÃ§in aÅŸaÄŸÄ±daki baÄŸlantÄ±larÄ± kullanabilirsiniz: Docker Serisi #1 Docker Serisi #2 â€” Docker Engine BÃ¶lÃ¼m 1 Docker Serisi #3 â€” Docker Engine BÃ¶lÃ¼m 2 Docker Serisi #4 â€” Docker Compose Serinin bu bÃ¶lÃ¼mÃ¼nde Docker Machineâ€™den ve teknoloji camiasÄ±nÄ±n bu sÄ±ralar Ã§ok sÄ±k duyduÄŸu Docker Swarmâ€™dan bahsedeceÄŸim. Swarm konusu derya deniz olduÄŸundan konuyu 2 ayrÄ± bÃ¶lÃ¼m halinde iÅŸleyeceÄŸim. Ä°lk bÃ¶lÃ¼mde Docker Machineâ€™den bahsedip Swarmâ€™a giriÅŸ yapacaÄŸÄ±z. Ä°kinci bÃ¶lÃ¼mdeyse Swarmâ€™Ä±n, makine topluluklarÄ±nÄ±n yÃ¶netiminde nasÄ±l kolaylÄ±klar saÄŸladÄ±ÄŸÄ±nÄ±; Ã¶rnek bir projenin makinelere daÄŸÄ±tÄ±lmasÄ± ve Ã¶lÃ§eklenmesiyle gÃ¶receÄŸiz!\nDocker Machine Nedir? Diyelim ki kendi makinenizde ya da bulutta (cloud) bir Docker makine aÄŸÄ± (cluster) kurmak istiyorsunuz. Eskiden bunu nasÄ±l yapardÄ±k? Gelin kendi makinemizde (Virtualbox kullandÄ±ÄŸÄ±mÄ±zÄ± varsayarak) yapacak olsaydÄ±k neler yapacaktÄ±k; bir gÃ¶zatalÄ±m:\nKuracaÄŸÄ±mÄ±z iÅŸletim sisteminin disk imajÄ±nÄ± (ISO) indirilmesi Virtualboxâ€™ta N tane VM yaratÄ±lmasÄ± ve her birinin ayarlarÄ±nÄ± dÃ¼zenlenmesi (disk, bellek, iÅŸletim sistemi imajÄ± vb.) Her bir VMâ€™i baÅŸlatÄ±p iÅŸletim sisteminin kurulmasÄ± ve yapÄ±landÄ±rÄ±lmasÄ± (dil/zaman/klayve ayarlarÄ±, disk ayarlarÄ± vb.) Her bir VM iÃ§in iÅŸletim sisteminin son gÃ¼ncellemelerinin yapÄ±lmasÄ± ve ihtiyaÃ§ olabilecek paketlerin kurulumu Her bir VM iÃ§in Docker paket deposu ayarlarÄ±nÄ±n yapÄ±lmasÄ±, Docker kurulumu ve yapÄ±landÄ±rmasÄ± (Docker Engineâ€™in dinleyeceÄŸi baÄŸlantÄ± noktalarÄ± -portâ€™lar-, atanacak etiketler -labelâ€™lar- vb.) DigitalOcean gibi bulut ortamlarÄ±nda Dockerâ€™Ä±n TLS ile Ã§alÄ±ÅŸacak ÅŸekilde ayarlanmasÄ± tavsiye ediliyor. Bu nedenle gerekli sertifikalarÄ±n yaratÄ±lmasÄ± ve Docker Engineâ€™in TLS modunda Ã§alÄ±ÅŸtÄ±rÄ±lmasÄ±. Bu listede yapÄ±lacak iÅŸler, proje ihtiyacÄ±na gÃ¶re uzayabilir. Elbette basit bir betikle (script) bu iÅŸler otomatize edilebilir. Peki farklÄ± bulut ortamlarÄ±nda da bu adÄ±mlarÄ± yapmanÄ±z gerekirse? Ä°ÅŸler zorlaÅŸÄ±yor, deÄŸil mi? ğŸ˜‰\nDocker Machine, tam olarak bunlarÄ± Ã§Ã¶zÃ¼yor. Ä°ster kendi makineniz, isterseniz de AWS ya da DigitalOcean gibi bir bulut ortamÄ± olsun; Docker Machine ile ihtiyacÄ±nÄ±z olan makineleri, istediÄŸiniz Ã¶zelliklerde ve istediÄŸiniz adetle yaratabiliyorsunuz.\nVirtualbox ile Yerel GeliÅŸtirme Serinin daha Ã¶nceki bÃ¶lÃ¼mlerinde sÃ¶ylediÄŸim gibi; eÄŸer Mac kullanÄ±yorsanÄ±z, Docker for Mac kullanmanÄ±z en saÄŸlÄ±klÄ±sÄ±. Ancak Ã¶zel bir ihtiyaÃ§tan ya da Swarm denemesi yapacaÄŸÄ±nÄ±z varsayÄ±mÄ±yla Linux tabanlÄ± Docker makinelerine ihtiyacÄ±nÄ±z varsa Docker Machineâ€™i kullanabilirsiniz:\ndocker-machine create -d virtualbox \\ --engine-insecure-registry registry.local \\ --engine-label role=node \\ --engine-label role=manager \\ manager1 Parametrelerin anlamÄ±na bakalÄ±m;\n-d: KullanÄ±lacak sÃ¼rÃ¼cÃ¼yÃ¼ (driver) belirler. Virtualbox iÃ§in virtualbox, AWS iÃ§in amazonec2, DigitalOcean iÃ§inse digitalocean yazabilirsiniz. --engine-insecure-registry: Docker Hub dÄ±ÅŸÄ±nda bir imaj deposu ve kendi Ã¼rettiÄŸiniz bir SSL sertifikasÄ± kullanÄ±yorsanÄ±z bu parametreyi kullanmalÄ±sÄ±nÄ±z. BÃ¶ylece Docker Engineâ€™in, imaj deposuna baÄŸlanmaya Ã§alÄ±ÅŸÄ±rken yaptÄ±ÄŸÄ± gÃ¼venlik kontrollerini geÃ§iÅŸtirmiÅŸ olacaksÄ±nÄ±z. --engine-label: Docker Engineâ€™e etiketler atayarak Ã¶zellikle Swarm modunda containerâ€™larÄ±n yerleÅŸiminin bu etiketlere gÃ¶re yapÄ±lmasÄ±nÄ± saÄŸlayabilirsiniz. Tek makine aÃ§acaksanÄ±z tanÄ±mlamasanÄ±z da olur. role=node gibi tanÄ±mlar tamamen tercihe baÄŸlÄ±. Diyelim ki makineye s3fs kurdunuz. Bu durumda Docker Engineâ€™e s3fs=enabled gibi bir etiket atayarak s3fsâ€™ten faydalanan containerâ€™larÄ±n bu makinelere yerleÅŸmesini saÄŸlayabilirsiniz. Sondaki manager1 ise makinemize ulaÅŸmak iÃ§in kullanacaÄŸÄ±mÄ±z isim olacak. Ä°lk makinemizi yarattÄ±ktan sonra docker-machine ls komutunu verirsek aÃ§Ä±k olan makinelerimiz listelenecektir. Daha Ã¶nce farklÄ± bulut ortamlarÄ±nda makineler aÃ§tÄ±ysanÄ±z bu makineler de bu listelemede gÃ¶zÃ¼kecektir. Yani ortam baÄŸÄ±msÄ±z olarak Docker Machine ile aÃ§tÄ±ÄŸÄ±nÄ±z tÃ¼m makineleri gÃ¶rme imkanÄ±na sahipsiniz.\n--filter driver=virtualbox ya da --filter label=role=worker gibi parametrelerle listelemeyi kontrol edebiliyorsunuz.\nOluÅŸturduÄŸunuz makineleri silmek isterseniz;\ndocker-machine rm deneme komutuyla silebilirsiniz.\nMakinenin iÃ§ine SSH ile girmek iÃ§in;\ndocker-machine ssh deneme komutunu verebilirsiniz. Ä°Ã§ine girdikten sonra docker komutlarÄ±yla istediÄŸiniz gibi Ã§alÄ±ÅŸabilirsiniz. Alternatif olarak kendi makinenizden bu makineyi hedefleyerek Ã§alÄ±ÅŸabilmek iÃ§in;\neval $(docker-machine env deneme) komutunu verebilirsiniz. Bu komut, bulunduÄŸunuz terminal oturumundaki DOCKER_HOST vb. deÄŸiÅŸkenlerin deÄŸerlerini, Docker Machine ile aÃ§tÄ±ÄŸÄ±nÄ±z makinenin deÄŸerleriyle deÄŸiÅŸtirerek, yazdÄ±ÄŸÄ±nÄ±z komutlarÄ±n o makine tarafÄ±ndan Ã§alÄ±ÅŸtÄ±rÄ±lÄ±p Ã§Ä±ktÄ±sÄ±nÄ±n sizin makinenizde gÃ¶sterilmesini saÄŸlar. Yani kendi makinenizden, uzaktaki makinede docker komutlarÄ± Ã§alÄ±ÅŸtÄ±rmÄ±ÅŸ oluyorsunuz.\nTekrar kendi makinenizdeki Docker Engineâ€™e dÃ¶nmek isterseniz terminali aÃ§Ä±p kapatabilir ya da;\neval $(docker-machine env -u) Protip: Docker Machineâ€™i Ã¶zellikle AWS vb. bulut ortamlarÄ±nda makine aÃ§mak iÃ§in kullanacaksanÄ±z 0.12.2+ kullanmanÄ±zÄ± Ã¶neririm. Aradaki sÃ¼rÃ¼mlerde Ubuntu vb. daÄŸÄ±tÄ±mlardaki deÄŸiÅŸiklikler nedeniyle problem yaÅŸayabilirsiniz.\nDocker Machine ile yapabileceÄŸiniz diÄŸer iÅŸlemler hakkÄ±nda bilgi almak iÃ§in docker-mackine komutunu hiÃ§ bir parametre olmadan vermeniz yeterli. Alt komutlarla ilgili bilgi almak iÃ§inse Ã¶rneÄŸin;\ndocker-machine create --help yazabilirsiniz.\nDocker ekosistemindeki deÄŸiÅŸiklikler son derece hÄ±zlÄ± gerÃ§ekleÅŸiyor ve zaman zaman alt projeler bu deÄŸiÅŸime ayak uyduramayabiliyor. Ãœst paragrafta sÃ¶ylediÄŸim ÅŸekilde docker-machineâ€™in desteklediÄŸi komutlara baktÄ±ysanÄ±z swarmâ€™la ilgili de bazÄ± komutlar iÃ§erdiÄŸini gÃ¶receksiniz. Swarm oluÅŸturmak iÃ§in, aÅŸaÄŸÄ±da bahsedeceÄŸim yeni yÃ¶ntemleri kullanmanÄ±z daha iyi olur. Docker Machine ile swarm yÃ¶neticisi yaratmak ya da swarm aÄŸÄ±na dahil olmak ÅŸimdiden demode sayÄ±lmaya baÅŸlamÄ±ÅŸ bile!\nAWSâ€™de Makine AÃ§mak Docker Machineâ€™in gÃ¼Ã§lÃ¼ yanlarÄ±ndan birisi bulut ortamlarÄ±nda da rahatlÄ±kla makine aÃ§abiliyor olmanÄ±z. Bunun iÃ§in AWSâ€™de bir hesabÄ±nÄ±z ve bu hesaba ait anahtarlarÄ±n (token) elinizde olduÄŸundan emin olun.\ndocker-machine create -d amazonec2 \\ --amazonec2-access-key erisim-anahtari \\ --amazonec2-secret-key cok-gizli-anahtar \\ --amazonec2-region eu-west-1 \\ --amazonec2-vpc-id ozel-vpc-id \\ --amazonec2-instance-type m4.large \\ --amazonec2-root-size 50 \\ --amazonec2-iam-instance-profile automated \\ --amazonec2-monitoring \\ --engine-label role=node n1 KullandÄ±ÄŸÄ±m parametrelerin isimlerinden anlaÅŸÄ±ldÄ±ÄŸÄ±nÄ± dÃ¼ÅŸÃ¼nÃ¼yorum. Sadece bazÄ±larÄ±nÄ± neden Ã¶zellikle yazdÄ±ÄŸÄ±mÄ± paylaÅŸayÄ±m;\n--amazonec2-vpc-id: Ã–ntanÄ±mlÄ± VPC aÄŸÄ±nÄ± sildiyseniz ya da farklÄ± bir VPC aÄŸÄ± kullanÄ±yorsanÄ±z mutlaka belirtmeniz gerekiyor. --amazonec2-iam-instance-profile: Makineki containerâ€™lar aracÄ±lÄ±ÄŸÄ±yla AWS Ã¼stÃ¼ndeki diÄŸer kaynaklara (Ã¶rneÄŸin ben EC2 etiketlerini okumak iÃ§in kullanÄ±yorum) gizli anahtarlarÄ±nÄ±zÄ± vermeden ulaÅŸabilmek iÃ§in kullanabilirsiniz. Docker Machine Ä°puÃ§larÄ± ğŸ’¡ Docker Machine, aÃ§tÄ±ÄŸÄ± makinelere ait tÃ¼m verileri ve oluÅŸturduÄŸu SSL anahtarlarÄ±nÄ± ~/.docker/machine dizinine yazar. Bu dizine eriÅŸiminizi bir ÅŸekilde kaybederseniz, yarattÄ±ÄŸÄ±nÄ±z makinelere eriÅŸiminizi de kaybedersiniz. Ben Ã§Ã¶zÃ¼m olarak bu dizini Google Driveâ€™a taÅŸÄ±yÄ±p MACHINE_STORAGE_PATH Ã§evresel deÄŸiÅŸkenini Google Driveâ€™daki dizini gÃ¶sterecek ÅŸekilde ayarladÄ±m. Docker Machine ile bulut ortamÄ±nda makine aÃ§Ä±yorsanÄ±z Ã§ok fazla parametre kullanmanÄ±z gerekiyor. Bu parametreleri sÄ±kÃ§a kullanÄ±yorsanÄ±z Ã§evresel deÄŸiÅŸken karÅŸÄ±lÄ±klarÄ±nÄ± tanÄ±mlayarak Ã¶ntanÄ±mlÄ± hale getirebilirsiniz. Ã–rneÄŸin AWS hesap anahtarÄ±nÄ±zÄ± (access key) AWS_ACCESS_KEY_ID deÄŸiÅŸkeni Ã¼stÃ¼nden, kullandÄ±ÄŸÄ±nÄ±z imajÄ± da AWS_AMI Ã¼stÃ¼nden tanÄ±mlayabilirsiniz. Bu tÃ¼r baÅŸka ne deÄŸiÅŸkenler olduÄŸunu gÃ¶rmek iÃ§in docker-machine create -d amazonec2 (farklÄ± bulut ortamlarÄ± iÃ§in farklÄ± sÃ¼rÃ¼cÃ¼ adÄ± verebilirsiniz) komutunu verebilirsiniz. Docker Machineâ€™i bulut ortamÄ±nda kullanmayÄ± dÃ¼ÅŸÃ¼nÃ¼yorsanÄ±z ve servis keÅŸfi (service discovery) ihtiyaÃ§larÄ±nÄ±z iÃ§in de Dockerâ€™Ä± kullanmayÄ± dÃ¼ÅŸÃ¼nÃ¼yorsanÄ±z, TLS sizin iÃ§in bir problem oluÅŸturabilir. Bu senaryoda yÃ¶netici makineler Ã¼stÃ¼nde TLSâ€™i kapatabilir ya da Docker Machine kullanmayabilirsiniz. Benim bÃ¶yle ihtiyaÃ§larÄ±m olduÄŸundan kurulumlarÄ±mÄ± tektipleÅŸtirmek amacÄ±yla kapsamlÄ± bir betik yazdÄ±m. Docker Swarm Nedir? Bu yazÄ±yÄ± yazdÄ±ÄŸÄ±m sÄ±rada Docker CE 17.09.0-ce-mac35 (19611) var.\nSwarm, yÃ¶netici (master) ve yÃ¶netilen (worker) adÄ± verilen makinelerin oluÅŸturduÄŸu bir aÄŸdÄ±r (cluster). Bir Swarm aÄŸÄ± oluÅŸturduÄŸunuzda aslÄ±nda bu aÄŸda en az bir adet yÃ¶netici makine vardÄ±r ve yÃ¶netilenler bu aÄŸa katÄ±lÄ±rlar. Herhangi bir anda, herhangi bir yÃ¶netilen makine, yÃ¶netici olarak atanabilir. Ancak aÄŸda baÄŸlÄ± bulunan makineler, aÄŸ ve DNS tanÄ±mlarÄ±, Ã§alÄ±ÅŸan servislerin kayÄ±tlarÄ± vb. tÃ¼m bilgiler (kÄ±saca makine topluluÄŸunun o anki durumu) yalnÄ±zca yÃ¶neticilerde tutulur ve bu bilgilere yalnÄ±zca yÃ¶neticiler Ã¼stÃ¼nden ulaÅŸÄ±labilir. Son olarak Swarm yaratmak ya da mevcut bir Swarm aÄŸÄ±na dahil olmak iÃ§in Docker (â‰¥ 1.12) kurulu olmasÄ± yeterlidir. Swarm iÃ§in birden fazla makineye ihtiyacÄ±m olduÄŸundan burada anlattÄ±ÄŸÄ±m her ÅŸeyi Docker Machine ve Virtualbox aracÄ±lÄ±ÄŸÄ±yla yarattÄ±ÄŸÄ±m sanal makineler Ã¼stÃ¼nde gÃ¶stereceÄŸim.\nYazÄ±nÄ±n geri kalanÄ±nÄ± benimle birlikte takip edebilmek iÃ§in aÅŸaÄŸÄ±daki 3 sanal makineyi yaratÄ±n:\ndocker-machine create -d virtualbox \\ --engine-label role=mgr \\ mgr1 docker-machine create -d virtualbox \\ --engine-label role=node \\ n1 docker-machine create -d virtualbox \\ --engine-label role=node \\ n2 role etiketiyle makineleri ikiye ayÄ±rdÄ±k. Deneme yapmamÄ±z nedeniyle yalnÄ±zca 1 yÃ¶netici (role=mgr) ve 2 yÃ¶netilen (role=node) makinemiz var. GerÃ§ek ortamda ise minimum Ã¼Ã§ (tekil numara olmasÄ±) yÃ¶neticiniz olmasÄ± tavsiye ediliyor. Her yÃ¶netici, aynÄ± zamanda yÃ¶netilen de olabiliyor. Yani yÃ¶netici makineleriniz, aÄŸÄ±n durumunu tutmakla birlikte Ã¼stÃ¼ne atacaÄŸÄ±nÄ±z bir kaÃ§ containerâ€™Ä± da Ã§alÄ±ÅŸtÄ±rmaktan geri kalmayacaktÄ±r. ğŸ™‚\nMakinelerin hepsini oluÅŸturduktan sonra ÅŸÃ¶yle bir ÅŸey gÃ¶rmeliyiz:\nMakinelerimiz hazÄ±r olduÄŸuna gÃ¶re, yÃ¶neticiye baÄŸlanÄ±p Swarm aÄŸÄ±mÄ±zÄ± yaratmaya baÅŸlayabiliriz:\n$ eval $(docker-machine env mgr1) $ docker swarm init --advertise-addr $(dm ip mgr1) Swarm initialized: current node (xwpzchdnz1fl1xq2shalhxexq) is now a manager. To add a worker to this swarm, run the following command: docker swarm join --token SWMTKN-1â€“1yavlpsjjd0xx6wujmngq6tvjcrpin5j3zm6kv4cwcyp2y1gad-04trkq963fymb0541nzbdkpbm 192.168.99.101:2377 To add a manager to this swarm, run â€˜docker swarm join-token managerâ€™ and follow the instructions. docker swarm init komutunu verdiÄŸinizde mgr1 makinesinde Swarm aÄŸÄ±nÄ±zÄ± yaratmÄ±ÅŸ bulunuyorsunuz. Bu makine Ã¼stÃ¼nde docker info komutunu verirseniz ÅŸÃ¶yle bir ÅŸey gÃ¶rmelisiniz:\n$ docker info ... Swarm: active NodeID: xwpzchdnz1fl1xq2shalhxexq Is Manager: true ClusterID: 53x1z42eir65p7gvw1nc5utuy Managers: 1 Nodes: 1 ... Åimdi diÄŸer makineleri yeni Swarm aÄŸÄ±mÄ±za baÄŸlayalÄ±m:\n$ eval $(docker-machine env n1) docker swarm join â€” token SWMTKN-1â€“1yavlpsjjd0xx6wujmngq6tvjcrpin5j3zm6kv4cwcyp2y1gad-04trkq963fymb0541nzbdkpbm 192.168.99.101:2377 â This node joined a swarm as a worker. $ eval $(docker-machine env n2) docker swarm join â€” token SWMTKN-1â€“1yavlpsjjd0xx6wujmngq6tvjcrpin5j3zm6kv4cwcyp2y1gad-04trkq963fymb0541nzbdkpbm 192.168.99.101:2377 â This node joined a swarm as a worker. mgr1â€˜e geri gidip Swarm aÄŸÄ±mÄ±za bir bakalÄ±m:\ndocker node ls komutuyla yÃ¶netici makinenin bildiÄŸi tÃ¼m makineleri listeleyebilirsiniz.\nArtÄ±k kullanmaya hazÄ±r bir Swarm aÄŸÄ±mÄ±z var! Devam etmeden Ã¶nce Swarm terminolojisinden biraz bahsetmekte fayda var.\nDocker Swarm Terminolojisi Config: Containerâ€™larÄ±nÄ±za ait yapÄ±landÄ±rma dosyalarÄ± ya da dÄ±ÅŸarÄ±dan verebileceÄŸiniz Ã§eÅŸitli amaÃ§lÄ± dosyalarÄ± Docker Config aracÄ±lÄ±ÄŸÄ±yla verebilirsiniz. Serinin ileriki bÃ¶lÃ¼mlerinde bu Ã¶zelliÄŸi kullanÄ±yor olacaÄŸÄ±z. TanÄ±mladÄ±ÄŸÄ±nÄ±z tÃ¼m dosyalar (configâ€™ler), Swarm aÄŸÄ± genelinde yalnÄ±zca onay verdiÄŸiniz makineler tarafÄ±ndan eriÅŸilebilir durumda olacaktÄ±r. Secret: Herhangi bir amaÃ§la kullandÄ±ÄŸÄ±nÄ±z ve gizli kalmasÄ± gerekebilecek ÅŸifre, makine adresi, kullanÄ±cÄ± adÄ± vb. bilgileri Docker Secret aracÄ±lÄ±ÄŸÄ±yla gÃ¼venli bir ÅŸekilde saklayabilirsiniz. TanÄ±mladÄ±ÄŸÄ±nÄ±z tÃ¼m sÄ±rlar (secretâ€™lar), Swarm aÄŸÄ± genelinde yalnÄ±zca onay verdiÄŸiniz makineler tarafÄ±ndan eriÅŸilebilir durumda olacaktÄ±r. Volume: Swarm kullanÄ±rken de tÄ±pkÄ± kendi makinenizde yapabildiÄŸiniz gibi dÄ±ÅŸarÄ±dan disk alanlarÄ± baÄŸlayabilirsiniz. Bunu yine ev sahibi makine aracÄ±lÄ±ÄŸÄ±yla yapabileceÄŸiniz gibi, eklentiler (plugins) aracÄ±lÄ±ÄŸÄ±yla da yapabilirsiniz. Network: Swarm kullanmayÄ± dÃ¼ÅŸÃ¼nÃ¼yorsanÄ±z, bu konu, bilmeniz gerekenlerin baÅŸÄ±nda geliyor. Swarmâ€™daki servis keÅŸfi, Swarmâ€™la birlikte yaratÄ±lan alt aÄŸlara (ve bunlara baÄŸlÄ± IP havuzlarÄ±) ve servislerle oluÅŸturulan DNS kayÄ±tlarÄ±na dayanÄ±yor. Swarmâ€™Ä± anlatÄ±rken bu konuya da Ã¶zel olarak deÄŸiniyor olacaÄŸÄ±m. Service: AynÄ± containerâ€™dan bir veya daha fazlasÄ±nÄ±n, ayarlarÄ±yla birlikte gruplanmasÄ±na servis adÄ± veriliyor. Ã–rneÄŸin bir MySQL containerâ€™Ä±nÄ±z varsa; bu containerâ€™dan kaÃ§ tane Ã§alÄ±ÅŸacaÄŸÄ±nÄ±, hangi makinelere, hangi kurallarla yerleÅŸtirileceÄŸini, kullanÄ±lacak disk alanlarÄ±nÄ±, dÄ±ÅŸarÄ±ya aÃ§Ä±lacak baÄŸlantÄ± noktalarÄ±nÄ±, Ã§evresel deÄŸiÅŸkenlerini ve daha bir Ã§ok ayarÄ±nÄ± servis iÃ§erisinde tanÄ±mlayabiliyoruz. Stack: Servislerin, aÄŸlarÄ±n ve disk alanlarÄ±nÄ±n, yapÄ±landÄ±rma dosyalarÄ± ve sÄ±r tanÄ±mlarÄ±nÄ±n oluÅŸturduÄŸu daha bÃ¼yÃ¼k gruba stack diyoruz. Ã–rneÄŸin, MySQL veritabanÄ±yla konuÅŸan bir uygulamanÄ±z varsa; uygulamanÄ±zÄ± ve veritabanÄ±nÄ± bir stack iÃ§erisinde tanÄ±mlayÄ±p rahatlÄ±kla yÃ¶netebilirsiniz. Stack yardÄ±mÄ±yla saniyeler iÃ§erisinde uygulamanÄ±zÄ± yayÄ±na alabilir, kaldÄ±rabilir ya da aÅŸaÄŸÄ±/yukarÄ± Ã¶lÃ§ekleyebilirsiniz. Docker Swarm Demo #1 Ä°lk denememizi basit tutalÄ±m. tutum/hello-world imajÄ±ndan 2 tane ayaÄŸa kaldÄ±rarak, Swarmâ€™Ä±n basitÃ§e nasÄ±l Ã§alÄ±ÅŸtÄ±ÄŸÄ±nÄ± gÃ¶relim:\ndocker service create -d --name helloworld \\ --constraint engine.labels.role==node \\ -p 80:80 \\ --replicas 2 \\ tutum/hello-world YukarÄ±daki komutla; tutum/hello-world servisini, yalnÄ±zca node rolÃ¼ndeki makinelere, toplamda 2 container olacak ve 80. baÄŸlantÄ± noktasÄ±nÄ± dÄ±ÅŸarÄ±ya aÃ§acak ÅŸekilde â€œdaÄŸÄ±tÄ±yoruzâ€ (schedule). Bu komutu Ã§alÄ±ÅŸtÄ±rdÄ±ÄŸÄ±nÄ±zda servise ait tanÄ±mlayÄ±cÄ±yÄ± (Service ID) dÃ¶necektir. Dilerseniz bu tanÄ±mlayÄ±cÄ±yÄ± ya da servisin ismini vererek sorgulama yapabilirsiniz:\ndocker service komutlarÄ±yla â€œdeployâ€ ettiÄŸimiz servislerimizi, Ã§alÄ±ÅŸtÄ±klarÄ± makineler ve durum bilgileriyle gÃ¶rebiliyoruz.\nBen makineleri Virtualboxâ€™da yarattÄ±ÄŸÄ±mda aldÄ±ÄŸÄ±m IPâ€™ler ÅŸÃ¶yleymiÅŸ:\nmgr1: 192.168.99.101 n1: 192.168.99.102 n2: 192.168.99.103 Yeni servisimizi test edelim mi? ğŸ¤ğŸ»\nHangi makineye istek attÄ±ÄŸÄ±mÄ± farkettiniz mi? 192.168.99.101! Yani mgr1! E hani sadece rolÃ¼ node olan makinelere yerleÅŸtirmiÅŸtik servisi? ğŸ˜³ Åimdi arka arkaya defalarca kez sayfayÄ± yenileyin. â€œMy hostname isâ€ ifadesinin karÅŸÄ±sÄ±ndaki tanÄ±mlayÄ±cÄ±nÄ±n sÃ¼rekli deÄŸiÅŸtiÄŸini gÃ¶receksiniz. AynÄ± IPâ€™ye istek atÄ±yoruz ama farklÄ± cevaplar alÄ±yoruz. Servisimiz bir de yÃ¼k dengeleme yapÄ±yor?! ğŸ˜®\nBir Ã¼stteki ekran gÃ¶rÃ¼ntÃ¼sÃ¼nde aÃ§Ä±kÃ§a gÃ¶rÃ¼ldÃ¼ÄŸÃ¼ gibi; aslÄ±nda servislerimizden 2 adet var ve yalnÄ±zca rolÃ¼ node olan n1 ve n2 makinelerine yerleÅŸtirilmiÅŸ durumda. Peki nasÄ±l oluyor da mgr1 makinesine istek atÄ±nca cevap alÄ±yoruz? Cevap: ingress aÄŸÄ±! Docker 1.12+ ile gelen bu Ã¶zellik sayesinde eÄŸer bir servis, dÄ±ÅŸarÄ± herhangi bir baÄŸlantÄ± noktasÄ± aÃ§arsa, bu baÄŸlantÄ± noktasÄ± tÃ¼m makinelerde aÃ§Ä±lÄ±r ve gelen istekler hangi makineye gelirse gelsin Swarm Ã¼zerinde o servisi Ã§alÄ±ÅŸtÄ±ran makinelere yÃ¶nlendirilir. Etkileyici, deÄŸil mi? ğŸ‘ğŸ»ğŸ‘ğŸ»ğŸ‘ğŸ»\ningress aÄŸÄ± sayesinde uygulamamÄ±za her makine Ã¼stÃ¼nden eriÅŸilebiliyor! ğŸ‘ğŸ»\nÃœstteki diagramâ€™da, tÃ¼m VMâ€™lerin Ã¼stÃ¼nde bir yÃ¼k dengeleyici (LB) olduÄŸunu varsayalÄ±m. Bir ÅŸekilde Swarm iÃ§erisindeki tÃ¼m makinelerin adresini LBâ€™e ekleyebilirsek; tek bir noktadan uygulamamÄ±za Ã¶lÃ§eklenebilir bir ÅŸekilde ulaÅŸabilir hale gelmiÅŸ oluyoruz. Diyelim ki; uygulamamÄ±z bu ÅŸekilde Ã§alÄ±ÅŸÄ±rken Ã§ok fazla istek gelmeye baÅŸladÄ± ve birer containerâ€™a daha ihtiyacÄ±mÄ±z var. Tek yapmamÄ±z gereken:\nBir ÅŸey dikkatinizi Ã§ekti mi? YalnÄ±zca 2 node makinemiz var ve bu nedenle aynÄ± servisten her makinede artÄ±k iki adet Ã§alÄ±ÅŸmaya baÅŸladÄ±. Peki ama 80. baÄŸlantÄ± noktasÄ±nÄ± hala nasÄ±l dinliyoruz? SÃ¼rekli istek atarsanÄ±z, yukarÄ±daki ekran gÃ¶rÃ¼ntÃ¼sÃ¼nÃ¼n de teyid ettiÄŸi ÅŸekilde, 4 tane containerâ€™Ä±n da baÅŸarÄ±lÄ± ÅŸekilde Ã§alÄ±ÅŸtÄ±ÄŸÄ±nÄ± gÃ¶receksiniz.\nCevabÄ± aslÄ±nda yukarÄ±daki diyagramâ€™da! Ingress aÄŸÄ± her zaman mevcut ve herhangi bir ayar yapmanÄ±za gerek kalmaksÄ±zÄ±n, servisleriniz iÃ§in baÅŸlatÄ±lan her containerâ€™a bu aÄŸÄ±n IP havuzundan farklÄ± bir adres veriliyor. Swarm iÃ§erisinde Ã§alÄ±ÅŸan yÃ¼k dengeleyiciler, her makinede dinlenen 80. baÄŸlantÄ± noktasÄ±nÄ±n, hangi containerâ€™lara yÃ¶nlendirileceÄŸini yaptÄ±ÄŸÄ±nÄ±z servis tanÄ±mÄ±ndan dolayÄ± biliyorlar ve otomatik olarak istekleri yÃ¶nlendiriyorlar!\nn1 ya da n2â€˜ye baÄŸlanÄ±p containerâ€™larÄ± rastgele Ã¶ldÃ¼rmeyi deneyin. Swarm, otomatik olarak yeni containerâ€™lar baÅŸlatacak ve Ã¶lÃ§eklenebilirlik iÃ§in ayarladÄ±ÄŸÄ±nÄ±z â€œminimum 4 container olsunâ€ kuralÄ±nÄ± saÄŸlamaya devam edecektir. ğŸ‰\nServisinize ait imajÄ± (Ã¶rneÄŸin uygulamanÄ±zÄ±n yeni sÃ¼rÃ¼mÃ¼ Ã§Ä±ktÄ±ÄŸÄ±nda), Ã§evresel deÄŸiÅŸkenleri, yapÄ±landÄ±rma ya da sÄ±r dosyalarÄ±nÄ±, yerleÅŸim ayarlarÄ±nÄ± ve diÄŸer pek Ã§ok ayarÄ±, servisinizi kapatmak zorunda kalmadan ya da herhangi bir servis dÄ±ÅŸÄ± durum oluÅŸmadan gÃ¼ncelleyebilirsiniz:\ndocker service update -d \\ --env-add server.port=8080 --label-add foo=bar \\ helloworld DeÄŸiÅŸtirebileceÄŸiniz ayarlarla ilgili daha detaylÄ± bilgi almak iÃ§in;\ndocker service update --help komutunu kullanabilirsiniz. YaptÄ±ÄŸÄ±nÄ±z deÄŸiÅŸikliklerde bir problem oluÅŸmasÄ± halinde bir Ã¶nceki kararlÄ± duruma geri dÃ¶nmek iÃ§in\ndocker service rollback helloworld komutunu kullanabilirsiniz.\nServislerin gÃ¼Ã§lÃ¼ Ã¶zelliklerinden bir diÄŸeri ise tÃ¼m containerâ€™larÄ±n log kayÄ±tlarÄ±nÄ± bir arada gÃ¶rme ÅŸansÄ± vermesi:\ndocker service logs --tail 10 -f helloworld KiÅŸisel fikrimi sorarsanÄ±z; bu Ã¶zellik oldukÃ§a iÅŸe yarÄ±yor olmakla beraber gerÃ§ek ortamda Ã§alÄ±ÅŸan servisler iÃ§in pek yeterli olmuyor. Birden fazla makinenin kayÄ±tlarÄ±nÄ± bir araya topladÄ±ÄŸÄ±nÄ±zdan birbirine girmiÅŸ karman Ã§orman kayÄ±tlarla karÅŸÄ±laÅŸabiliyorsunuz. Ancak Dockerâ€™Ä±n log sÃ¼rÃ¼cÃ¼leri Ã¼stÃ¼nden bu kayÄ±tlarÄ± logstash vb. servislerle paylaÅŸabildiÄŸini dÃ¼ÅŸÃ¼nÃ¼rsek Ã§ok da mÃ¼him deÄŸil.\nKÃ¼Ã§Ã¼k ve fazla baÄŸÄ±mlÄ±lÄ±klarÄ± olmayan projelerinizi yalnÄ±zca docker service komutlarÄ±yla sunuculara daÄŸÄ±tabilir ve Ã¶lÃ§ekleyebilirsiniz. Daha bÃ¼yÃ¼k Ã¶lÃ§ekli projeler iÃ§in yapÄ±lmasÄ± gerekenleri serinin bir sonraki yazÄ±sÄ±nda ele alacaÄŸÄ±m.\nBilgisayarÄ±nÄ±zÄ±n kaynaklarÄ±nÄ± boÅŸ yere harcamamak iÃ§in oluÅŸturduÄŸunuz servisi;\ndocker service rm helloworld komutuyla, Docker Makine ile yarattÄ±ÄŸÄ±nÄ±z VMâ€™leri ise;\ndocker-machine rm mgr1 n1 n2 komutuyla silebilirsiniz.\nBu bÃ¶lÃ¼mÃ¼nÃ¼n de sonuna geldik. Bir sonraki bÃ¶lÃ¼m olan â€œDocker Serisi #5 â€” Docker Machine \u0026 Swarm BÃ¶lÃ¼m 2â€â€˜de gÃ¶rÃ¼ÅŸmek dileÄŸiyle!\nGidiÅŸÃ¢ta gÃ¶re bu planda zaman zaman deÄŸiÅŸiklikler yapacak olsam da serinin tÃ¼m bÃ¶lÃ¼mlerinin planÄ±na ÅŸuradan ulaÅŸabilirsiniz.\n",
  "wordCount" : "2262",
  "inLanguage": "tr",
  "datePublished": "2017-10-30T00:00:00Z",
  "dateModified": "2021-04-26T00:02:59+03:00",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://alperkan.at/tr/2017/10/docker-serisi-5/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Alper Kanat",
    "logo": {
      "@type": "ImageObject",
      "url": "https://alperkan.at/favicon.ico"
    }
  }
}
</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><noscript><style type=text/css>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:#1d1e20;--entry:#2e2e33;--primary:rgba(255, 255, 255, 0.84);--secondary:rgba(255, 255, 255, 0.56);--tertiary:rgba(255, 255, 255, 0.16);--content:rgba(255, 255, 255, 0.74);--hljs-bg:#2e2e33;--code-bg:#37383e;--border:#333}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><header class=header><nav class=nav><div class=logo><a href=https://alperkan.at/tr/ accesskey=h title="Alper Kanat (Alt + H)">Alper Kanat</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li><li><a href=https://alperkan.at/ title=ğŸ‡¬ğŸ‡§ aria-label=ğŸ‡¬ğŸ‡§>En</a></li></ul></span></div><ul id=menu><li><a href=https://alperkan.at/tr/arsiv title=arÅŸiv><span>arÅŸiv</span></a></li><li><a href=https://alperkan.at/tr/tags title=etiketler><span>etiketler</span></a></li><li><a href=https://alperkan.at/tr/hakkimda title=hakkÄ±mda><span>hakkÄ±mda</span></a></li><li><a href=https://github.com/tunix/notebook title=notlarÄ±m><span>notlarÄ±m</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Docker Serisi #5 -- Docker Machine & Swarm BÃ¶lÃ¼m 1</h1><div class=post-meta>October 30, 2017</div></header><div class=post-content><ol start=5><li>bÃ¶lÃ¼me hoÅŸgeldiniz! ğŸ¤˜ğŸ» Serinin Ã¶nceki bÃ¶lÃ¼mlerine ulaÅŸmak iÃ§in aÅŸaÄŸÄ±daki baÄŸlantÄ±larÄ± kullanabilirsiniz:</li></ol><ul><li><a href=https://alperkan.at/tr/2016/07/docker-serisi-1/>Docker Serisi #1</a></li><li><a href=https://alperkan.at/tr/2016/09/docker-serisi-2/>Docker Serisi #2 â€” Docker Engine BÃ¶lÃ¼m 1</a></li><li><a href=https://alperkan.at/tr/2016/10/docker-serisi-3/>Docker Serisi #3 â€” Docker Engine BÃ¶lÃ¼m 2</a></li><li><a href=https://alperkan.at/tr/2017/03/docker-serisi-4/>Docker Serisi #4 â€” Docker Compose</a></li></ul><p>Serinin bu bÃ¶lÃ¼mÃ¼nde Docker Machineâ€™den ve teknoloji camiasÄ±nÄ±n bu sÄ±ralar Ã§ok sÄ±k duyduÄŸu Docker Swarmâ€™dan
bahsedeceÄŸim. Swarm konusu derya deniz olduÄŸundan konuyu 2 ayrÄ± bÃ¶lÃ¼m halinde iÅŸleyeceÄŸim. Ä°lk bÃ¶lÃ¼mde Docker
Machineâ€™den bahsedip Swarmâ€™a giriÅŸ yapacaÄŸÄ±z. Ä°kinci bÃ¶lÃ¼mdeyse Swarmâ€™Ä±n, makine topluluklarÄ±nÄ±n yÃ¶netiminde nasÄ±l
kolaylÄ±klar saÄŸladÄ±ÄŸÄ±nÄ±; Ã¶rnek bir projenin makinelere daÄŸÄ±tÄ±lmasÄ± ve Ã¶lÃ§eklenmesiyle gÃ¶receÄŸiz!</p><hr><h3 id=docker-machine-nedir>Docker Machine Nedir?<a hidden class=anchor aria-hidden=true href=#docker-machine-nedir>#</a></h3><p>Diyelim ki kendi makinenizde ya da bulutta (cloud) bir Docker makine aÄŸÄ± (cluster) kurmak istiyorsunuz. Eskiden bunu
nasÄ±l yapardÄ±k? Gelin kendi makinemizde (Virtualbox kullandÄ±ÄŸÄ±mÄ±zÄ± varsayarak) yapacak olsaydÄ±k neler yapacaktÄ±k; bir
gÃ¶zatalÄ±m:</p><ul><li>KuracaÄŸÄ±mÄ±z iÅŸletim sisteminin disk imajÄ±nÄ± (ISO) indirilmesi</li><li>Virtualboxâ€™ta N tane VM yaratÄ±lmasÄ± ve her birinin ayarlarÄ±nÄ± dÃ¼zenlenmesi (disk, bellek, iÅŸletim sistemi imajÄ± vb.)</li><li>Her bir VMâ€™i baÅŸlatÄ±p iÅŸletim sisteminin kurulmasÄ± ve yapÄ±landÄ±rÄ±lmasÄ± (dil/zaman/klayve ayarlarÄ±, disk ayarlarÄ± vb.)</li><li>Her bir VM iÃ§in iÅŸletim sisteminin son gÃ¼ncellemelerinin yapÄ±lmasÄ± ve ihtiyaÃ§ olabilecek paketlerin kurulumu</li><li>Her bir VM iÃ§in Docker paket deposu ayarlarÄ±nÄ±n yapÄ±lmasÄ±, Docker kurulumu ve yapÄ±landÄ±rmasÄ± (Docker Engineâ€™in
dinleyeceÄŸi baÄŸlantÄ± noktalarÄ± -portâ€™lar-, atanacak etiketler -labelâ€™lar- vb.)</li><li>DigitalOcean gibi bulut ortamlarÄ±nda Dockerâ€™Ä±n TLS ile Ã§alÄ±ÅŸacak ÅŸekilde ayarlanmasÄ± tavsiye ediliyor. Bu nedenle
gerekli sertifikalarÄ±n yaratÄ±lmasÄ± ve Docker Engineâ€™in TLS modunda Ã§alÄ±ÅŸtÄ±rÄ±lmasÄ±.</li></ul><p>Bu listede yapÄ±lacak iÅŸler, proje ihtiyacÄ±na gÃ¶re uzayabilir. Elbette basit bir betikle (script) bu iÅŸler otomatize
edilebilir. Peki farklÄ± bulut ortamlarÄ±nda da bu adÄ±mlarÄ± yapmanÄ±z gerekirse? Ä°ÅŸler zorlaÅŸÄ±yor, deÄŸil mi? ğŸ˜‰</p><p>Docker Machine, tam olarak bunlarÄ± Ã§Ã¶zÃ¼yor. Ä°ster kendi makineniz, isterseniz de AWS ya da DigitalOcean gibi bir bulut
ortamÄ± olsun; Docker Machine ile ihtiyacÄ±nÄ±z olan makineleri, istediÄŸiniz Ã¶zelliklerde ve istediÄŸiniz adetle
yaratabiliyorsunuz.</p><h4 id=virtualbox-ile-yerel-geliÅŸtirme>Virtualbox ile Yerel GeliÅŸtirme<a hidden class=anchor aria-hidden=true href=#virtualbox-ile-yerel-geliÅŸtirme>#</a></h4><p>Serinin daha Ã¶nceki bÃ¶lÃ¼mlerinde sÃ¶ylediÄŸim gibi; eÄŸer Mac kullanÄ±yorsanÄ±z, Docker for Mac kullanmanÄ±z en saÄŸlÄ±klÄ±sÄ±.
Ancak Ã¶zel bir ihtiyaÃ§tan ya da Swarm denemesi yapacaÄŸÄ±nÄ±z varsayÄ±mÄ±yla Linux tabanlÄ± Docker makinelerine ihtiyacÄ±nÄ±z
varsa Docker Machineâ€™i kullanabilirsiniz:</p><pre tabindex=0><code>docker-machine create -d virtualbox \
    --engine-insecure-registry registry.local \
    --engine-label role=node \
    --engine-label role=manager \
    manager1
</code></pre><p>Parametrelerin anlamÄ±na bakalÄ±m;</p><ul><li><code>-d</code>: KullanÄ±lacak sÃ¼rÃ¼cÃ¼yÃ¼ (driver) belirler. Virtualbox iÃ§in <code>virtualbox</code>, AWS iÃ§in <code>amazonec2</code>, DigitalOcean
iÃ§inse <code>digitalocean</code> yazabilirsiniz.</li><li><code>--engine-insecure-registry</code>: Docker Hub dÄ±ÅŸÄ±nda bir imaj deposu ve kendi Ã¼rettiÄŸiniz bir SSL sertifikasÄ±
kullanÄ±yorsanÄ±z bu parametreyi kullanmalÄ±sÄ±nÄ±z. BÃ¶ylece Docker Engineâ€™in, imaj deposuna baÄŸlanmaya Ã§alÄ±ÅŸÄ±rken yaptÄ±ÄŸÄ±
gÃ¼venlik kontrollerini geÃ§iÅŸtirmiÅŸ olacaksÄ±nÄ±z.</li><li><code>--engine-label</code>: Docker Engineâ€™e etiketler atayarak Ã¶zellikle Swarm modunda containerâ€™larÄ±n yerleÅŸiminin bu
etiketlere gÃ¶re yapÄ±lmasÄ±nÄ± saÄŸlayabilirsiniz. Tek makine aÃ§acaksanÄ±z tanÄ±mlamasanÄ±z da olur. <code>role=node</code> gibi
tanÄ±mlar tamamen tercihe baÄŸlÄ±. Diyelim ki makineye s3fs kurdunuz. Bu durumda Docker Engineâ€™e <code>s3fs=enabled</code> gibi
bir etiket atayarak s3fsâ€™ten faydalanan containerâ€™larÄ±n bu makinelere yerleÅŸmesini saÄŸlayabilirsiniz.</li></ul><p>Sondaki <code>manager1</code> ise makinemize ulaÅŸmak iÃ§in kullanacaÄŸÄ±mÄ±z isim olacak. Ä°lk makinemizi yarattÄ±ktan sonra
<code>docker-machine ls</code> komutunu verirsek aÃ§Ä±k olan makinelerimiz listelenecektir. Daha Ã¶nce farklÄ± bulut ortamlarÄ±nda
makineler aÃ§tÄ±ysanÄ±z bu makineler de bu listelemede gÃ¶zÃ¼kecektir. Yani <em>ortam baÄŸÄ±msÄ±z</em> olarak Docker Machine ile
aÃ§tÄ±ÄŸÄ±nÄ±z tÃ¼m makineleri gÃ¶rme imkanÄ±na sahipsiniz.</p><figure><img loading=lazy src=docker_machine_ls_ciktisi.png alt="--filter driver=virtualbox ya da --filter label=role=worker gibi parametrelerle listelemeyi kontrol edebiliyorsunuz."><figcaption><p><code>--filter driver=virtualbox</code> ya da <code>--filter label=role=worker</code> gibi parametrelerle listelemeyi kontrol edebiliyorsunuz.</p></figcaption></figure><p>OluÅŸturduÄŸunuz makineleri silmek isterseniz;</p><pre tabindex=0><code>docker-machine rm deneme
</code></pre><p>komutuyla silebilirsiniz.</p><p>Makinenin iÃ§ine SSH ile girmek iÃ§in;</p><pre tabindex=0><code>docker-machine ssh deneme
</code></pre><p>komutunu verebilirsiniz. Ä°Ã§ine girdikten sonra docker komutlarÄ±yla istediÄŸiniz gibi Ã§alÄ±ÅŸabilirsiniz. Alternatif olarak
kendi makinenizden bu makineyi hedefleyerek Ã§alÄ±ÅŸabilmek iÃ§in;</p><pre tabindex=0><code>eval $(docker-machine env deneme)
</code></pre><p>komutunu verebilirsiniz. Bu komut, bulunduÄŸunuz terminal oturumundaki <code>DOCKER_HOST</code> vb. deÄŸiÅŸkenlerin deÄŸerlerini,
Docker Machine ile aÃ§tÄ±ÄŸÄ±nÄ±z makinenin deÄŸerleriyle deÄŸiÅŸtirerek, yazdÄ±ÄŸÄ±nÄ±z komutlarÄ±n o makine tarafÄ±ndan
Ã§alÄ±ÅŸtÄ±rÄ±lÄ±p Ã§Ä±ktÄ±sÄ±nÄ±n sizin makinenizde gÃ¶sterilmesini saÄŸlar. Yani kendi makinenizden, uzaktaki makinede docker
komutlarÄ± Ã§alÄ±ÅŸtÄ±rmÄ±ÅŸ oluyorsunuz.</p><p>Tekrar kendi makinenizdeki Docker Engineâ€™e dÃ¶nmek isterseniz terminali aÃ§Ä±p kapatabilir ya da;</p><pre tabindex=0><code>eval $(docker-machine env -u)
</code></pre><blockquote><p>Protip: Docker Machineâ€™i Ã¶zellikle AWS vb. bulut ortamlarÄ±nda makine aÃ§mak iÃ§in kullanacaksanÄ±z 0.12.2+ kullanmanÄ±zÄ±
Ã¶neririm. Aradaki sÃ¼rÃ¼mlerde Ubuntu vb. daÄŸÄ±tÄ±mlardaki deÄŸiÅŸiklikler nedeniyle problem yaÅŸayabilirsiniz.</p></blockquote><p>Docker Machine ile yapabileceÄŸiniz diÄŸer iÅŸlemler hakkÄ±nda bilgi almak iÃ§in <code>docker-mackine</code> komutunu hiÃ§ bir parametre
olmadan vermeniz yeterli. Alt komutlarla ilgili bilgi almak iÃ§inse Ã¶rneÄŸin;</p><pre tabindex=0><code>docker-machine create --help
</code></pre><p>yazabilirsiniz.</p><p>Docker ekosistemindeki deÄŸiÅŸiklikler son derece hÄ±zlÄ± gerÃ§ekleÅŸiyor ve zaman zaman alt projeler bu deÄŸiÅŸime ayak
uyduramayabiliyor. Ãœst paragrafta sÃ¶ylediÄŸim ÅŸekilde <code>docker-machine</code>â€™in desteklediÄŸi komutlara baktÄ±ysanÄ±z swarmâ€™la
ilgili de bazÄ± komutlar iÃ§erdiÄŸini gÃ¶receksiniz. Swarm oluÅŸturmak iÃ§in, aÅŸaÄŸÄ±da bahsedeceÄŸim yeni yÃ¶ntemleri
kullanmanÄ±z daha iyi olur. Docker Machine ile swarm yÃ¶neticisi yaratmak ya da swarm aÄŸÄ±na dahil olmak ÅŸimdiden demode
sayÄ±lmaya baÅŸlamÄ±ÅŸ bile!</p><h4 id=awsde-makine-aÃ§mak>AWSâ€™de Makine AÃ§mak<a hidden class=anchor aria-hidden=true href=#awsde-makine-aÃ§mak>#</a></h4><p>Docker Machineâ€™in gÃ¼Ã§lÃ¼ yanlarÄ±ndan birisi bulut ortamlarÄ±nda da rahatlÄ±kla makine aÃ§abiliyor olmanÄ±z. Bunun iÃ§in
AWSâ€™de bir hesabÄ±nÄ±z ve bu hesaba ait anahtarlarÄ±n (token) elinizde olduÄŸundan emin olun.</p><pre tabindex=0><code>docker-machine create -d amazonec2 \
    --amazonec2-access-key erisim-anahtari \
    --amazonec2-secret-key cok-gizli-anahtar \
    --amazonec2-region eu-west-1 \
    --amazonec2-vpc-id ozel-vpc-id \
    --amazonec2-instance-type m4.large \
    --amazonec2-root-size 50 \
    --amazonec2-iam-instance-profile automated \
    --amazonec2-monitoring \
    --engine-label role=node n1
</code></pre><p>KullandÄ±ÄŸÄ±m parametrelerin isimlerinden anlaÅŸÄ±ldÄ±ÄŸÄ±nÄ± dÃ¼ÅŸÃ¼nÃ¼yorum. Sadece bazÄ±larÄ±nÄ± neden Ã¶zellikle yazdÄ±ÄŸÄ±mÄ±
paylaÅŸayÄ±m;</p><ul><li><code>--amazonec2-vpc-id</code>: Ã–ntanÄ±mlÄ± VPC aÄŸÄ±nÄ± sildiyseniz ya da farklÄ± bir VPC aÄŸÄ± kullanÄ±yorsanÄ±z mutlaka belirtmeniz
gerekiyor.</li><li><code>--amazonec2-iam-instance-profile</code>: Makineki containerâ€™lar aracÄ±lÄ±ÄŸÄ±yla AWS Ã¼stÃ¼ndeki diÄŸer kaynaklara (Ã¶rneÄŸin ben
EC2 etiketlerini okumak iÃ§in kullanÄ±yorum) gizli anahtarlarÄ±nÄ±zÄ± vermeden ulaÅŸabilmek iÃ§in kullanabilirsiniz.</li></ul><h4 id=docker-machine-ipuÃ§larÄ±->Docker Machine Ä°puÃ§larÄ± ğŸ’¡<a hidden class=anchor aria-hidden=true href=#docker-machine-ipuÃ§larÄ±->#</a></h4><ul><li>Docker Machine, aÃ§tÄ±ÄŸÄ± makinelere ait tÃ¼m verileri ve oluÅŸturduÄŸu SSL anahtarlarÄ±nÄ± <code>~/.docker/machine</code> dizinine
yazar. Bu dizine eriÅŸiminizi bir ÅŸekilde kaybederseniz, yarattÄ±ÄŸÄ±nÄ±z makinelere eriÅŸiminizi de kaybedersiniz. Ben
Ã§Ã¶zÃ¼m olarak bu dizini Google Driveâ€™a taÅŸÄ±yÄ±p <code>MACHINE_STORAGE_PATH</code> Ã§evresel deÄŸiÅŸkenini Google Driveâ€™daki dizini
gÃ¶sterecek ÅŸekilde ayarladÄ±m.</li><li>Docker Machine ile bulut ortamÄ±nda makine aÃ§Ä±yorsanÄ±z Ã§ok fazla parametre kullanmanÄ±z gerekiyor. Bu parametreleri
sÄ±kÃ§a kullanÄ±yorsanÄ±z Ã§evresel deÄŸiÅŸken karÅŸÄ±lÄ±klarÄ±nÄ± tanÄ±mlayarak Ã¶ntanÄ±mlÄ± hale getirebilirsiniz. Ã–rneÄŸin AWS
hesap anahtarÄ±nÄ±zÄ± (access key) <code>AWS_ACCESS_KEY_ID</code> deÄŸiÅŸkeni Ã¼stÃ¼nden, kullandÄ±ÄŸÄ±nÄ±z imajÄ± da <code>AWS_AMI</code> Ã¼stÃ¼nden
tanÄ±mlayabilirsiniz. Bu tÃ¼r baÅŸka ne deÄŸiÅŸkenler olduÄŸunu gÃ¶rmek iÃ§in <code>docker-machine create -d amazonec2</code> (farklÄ±
bulut ortamlarÄ± iÃ§in farklÄ± sÃ¼rÃ¼cÃ¼ adÄ± verebilirsiniz) komutunu verebilirsiniz.</li><li>Docker Machineâ€™i bulut ortamÄ±nda kullanmayÄ± dÃ¼ÅŸÃ¼nÃ¼yorsanÄ±z ve servis keÅŸfi (service discovery) ihtiyaÃ§larÄ±nÄ±z iÃ§in
de Dockerâ€™Ä± kullanmayÄ± dÃ¼ÅŸÃ¼nÃ¼yorsanÄ±z, TLS sizin iÃ§in bir problem oluÅŸturabilir. Bu senaryoda yÃ¶netici makineler
Ã¼stÃ¼nde TLSâ€™i kapatabilir ya da Docker Machine kullanmayabilirsiniz. Benim bÃ¶yle ihtiyaÃ§larÄ±m olduÄŸundan
kurulumlarÄ±mÄ± tektipleÅŸtirmek amacÄ±yla kapsamlÄ± bir betik yazdÄ±m.</li></ul><hr><h3 id=docker-swarm-nedir>Docker Swarm Nedir?<a hidden class=anchor aria-hidden=true href=#docker-swarm-nedir>#</a></h3><figure><img loading=lazy src=docker_version_dialog.png alt="Bu yazÄ±yÄ± yazdÄ±ÄŸÄ±m sÄ±rada Docker CE 17.09.0-ce-mac35 (19611) var."><figcaption><p>Bu yazÄ±yÄ± yazdÄ±ÄŸÄ±m sÄ±rada Docker CE 17.09.0-ce-mac35 (19611) var.</p></figcaption></figure><p>Swarm, yÃ¶netici (master) ve yÃ¶netilen (worker) adÄ± verilen makinelerin oluÅŸturduÄŸu bir aÄŸdÄ±r (cluster). Bir Swarm aÄŸÄ±
oluÅŸturduÄŸunuzda aslÄ±nda bu aÄŸda en az bir adet yÃ¶netici makine vardÄ±r ve yÃ¶netilenler bu aÄŸa katÄ±lÄ±rlar. Herhangi bir
anda, herhangi bir yÃ¶netilen makine, yÃ¶netici olarak atanabilir. Ancak aÄŸda baÄŸlÄ± bulunan makineler, aÄŸ ve DNS
tanÄ±mlarÄ±, Ã§alÄ±ÅŸan servislerin kayÄ±tlarÄ± vb. tÃ¼m bilgiler (kÄ±saca makine topluluÄŸunun o anki durumu) yalnÄ±zca
yÃ¶neticilerde tutulur ve bu bilgilere yalnÄ±zca yÃ¶neticiler Ã¼stÃ¼nden ulaÅŸÄ±labilir. Son olarak Swarm yaratmak ya da
mevcut bir Swarm aÄŸÄ±na dahil olmak iÃ§in Docker (â‰¥ 1.12) kurulu olmasÄ± yeterlidir. Swarm iÃ§in birden fazla makineye
ihtiyacÄ±m olduÄŸundan burada anlattÄ±ÄŸÄ±m her ÅŸeyi Docker Machine ve Virtualbox aracÄ±lÄ±ÄŸÄ±yla yarattÄ±ÄŸÄ±m sanal makineler
Ã¼stÃ¼nde gÃ¶stereceÄŸim.</p><p>YazÄ±nÄ±n geri kalanÄ±nÄ± benimle birlikte takip edebilmek iÃ§in aÅŸaÄŸÄ±daki 3 sanal makineyi yaratÄ±n:</p><pre tabindex=0><code>docker-machine create -d virtualbox \
    --engine-label role=mgr \
    mgr1

docker-machine create -d virtualbox \
    --engine-label role=node \
    n1

docker-machine create -d virtualbox \
    --engine-label role=node \
    n2
</code></pre><p><code>role</code> etiketiyle makineleri ikiye ayÄ±rdÄ±k. Deneme yapmamÄ±z nedeniyle yalnÄ±zca 1 yÃ¶netici (<code>role=mgr</code>) ve 2 yÃ¶netilen
(<code>role=node</code>) makinemiz var. GerÃ§ek ortamda ise minimum Ã¼Ã§ (tekil numara olmasÄ±) yÃ¶neticiniz olmasÄ± tavsiye ediliyor.
Her yÃ¶netici, aynÄ± zamanda yÃ¶netilen de olabiliyor. Yani yÃ¶netici makineleriniz, aÄŸÄ±n durumunu tutmakla birlikte Ã¼stÃ¼ne
atacaÄŸÄ±nÄ±z bir kaÃ§ containerâ€™Ä± da Ã§alÄ±ÅŸtÄ±rmaktan geri kalmayacaktÄ±r. ğŸ™‚</p><p>Makinelerin hepsini oluÅŸturduktan sonra ÅŸÃ¶yle bir ÅŸey gÃ¶rmeliyiz:</p><figure><img loading=lazy src=swarm_vm_yaratimi.png></figure><p>Makinelerimiz hazÄ±r olduÄŸuna gÃ¶re, yÃ¶neticiye baÄŸlanÄ±p Swarm aÄŸÄ±mÄ±zÄ± yaratmaya baÅŸlayabiliriz:</p><pre tabindex=0><code>$ eval $(docker-machine env mgr1)

$ docker swarm init --advertise-addr $(dm ip mgr1)
Swarm initialized: current node (xwpzchdnz1fl1xq2shalhxexq) is now a manager.

To add a worker to this swarm, run the following command:

docker swarm join --token SWMTKN-1â€“1yavlpsjjd0xx6wujmngq6tvjcrpin5j3zm6kv4cwcyp2y1gad-04trkq963fymb0541nzbdkpbm 192.168.99.101:2377

To add a manager to this swarm, run â€˜docker swarm join-token managerâ€™ and follow the instructions.
</code></pre><p><code>docker swarm init</code> komutunu verdiÄŸinizde mgr1 makinesinde Swarm aÄŸÄ±nÄ±zÄ± yaratmÄ±ÅŸ bulunuyorsunuz. Bu makine Ã¼stÃ¼nde
<code>docker info</code> komutunu verirseniz ÅŸÃ¶yle bir ÅŸey gÃ¶rmelisiniz:</p><pre tabindex=0><code>$ docker info
...
Swarm: active
NodeID: xwpzchdnz1fl1xq2shalhxexq
Is Manager: true
ClusterID: 53x1z42eir65p7gvw1nc5utuy
Managers: 1
Nodes: 1
...
</code></pre><p>Åimdi diÄŸer makineleri yeni Swarm aÄŸÄ±mÄ±za baÄŸlayalÄ±m:</p><pre tabindex=0><code>$ eval $(docker-machine env n1)

docker swarm join â€” token SWMTKN-1â€“1yavlpsjjd0xx6wujmngq6tvjcrpin5j3zm6kv4cwcyp2y1gad-04trkq963fymb0541nzbdkpbm 192.168.99.101:2377 â
This node joined a swarm as a worker.

$ eval $(docker-machine env n2)

docker swarm join â€” token SWMTKN-1â€“1yavlpsjjd0xx6wujmngq6tvjcrpin5j3zm6kv4cwcyp2y1gad-04trkq963fymb0541nzbdkpbm 192.168.99.101:2377 â
This node joined a swarm as a worker.
</code></pre><p><code>mgr1</code>&lsquo;e geri gidip Swarm aÄŸÄ±mÄ±za bir bakalÄ±m:</p><figure><img loading=lazy src=swarm_node_list.png alt="docker node ls komutuyla yÃ¶netici makinenin bildiÄŸi tÃ¼m makineleri listeleyebilirsiniz."><figcaption><p><code>docker node ls</code> komutuyla yÃ¶netici makinenin bildiÄŸi tÃ¼m makineleri listeleyebilirsiniz.</p></figcaption></figure><p>ArtÄ±k kullanmaya hazÄ±r bir Swarm aÄŸÄ±mÄ±z var! Devam etmeden Ã¶nce Swarm terminolojisinden biraz bahsetmekte fayda var.</p><h4 id=docker-swarm-terminolojisi>Docker Swarm Terminolojisi<a hidden class=anchor aria-hidden=true href=#docker-swarm-terminolojisi>#</a></h4><ul><li><strong>Config</strong>: Containerâ€™larÄ±nÄ±za ait yapÄ±landÄ±rma dosyalarÄ± ya da dÄ±ÅŸarÄ±dan verebileceÄŸiniz Ã§eÅŸitli amaÃ§lÄ± dosyalarÄ±
Docker Config aracÄ±lÄ±ÄŸÄ±yla verebilirsiniz. Serinin ileriki bÃ¶lÃ¼mlerinde bu Ã¶zelliÄŸi kullanÄ±yor olacaÄŸÄ±z.
TanÄ±mladÄ±ÄŸÄ±nÄ±z tÃ¼m dosyalar (configâ€™ler), Swarm aÄŸÄ± genelinde yalnÄ±zca onay verdiÄŸiniz makineler tarafÄ±ndan
eriÅŸilebilir durumda olacaktÄ±r.</li><li><strong>Secret</strong>: Herhangi bir amaÃ§la kullandÄ±ÄŸÄ±nÄ±z ve gizli kalmasÄ± gerekebilecek ÅŸifre, makine adresi, kullanÄ±cÄ± adÄ± vb.
bilgileri Docker Secret aracÄ±lÄ±ÄŸÄ±yla gÃ¼venli bir ÅŸekilde saklayabilirsiniz. TanÄ±mladÄ±ÄŸÄ±nÄ±z tÃ¼m sÄ±rlar (secretâ€™lar),
Swarm aÄŸÄ± genelinde yalnÄ±zca onay verdiÄŸiniz makineler tarafÄ±ndan eriÅŸilebilir durumda olacaktÄ±r.</li><li><strong>Volume</strong>: Swarm kullanÄ±rken de tÄ±pkÄ± kendi makinenizde yapabildiÄŸiniz gibi dÄ±ÅŸarÄ±dan disk alanlarÄ±
baÄŸlayabilirsiniz. Bunu yine ev sahibi makine aracÄ±lÄ±ÄŸÄ±yla yapabileceÄŸiniz gibi, eklentiler (plugins) aracÄ±lÄ±ÄŸÄ±yla
da yapabilirsiniz.</li><li><strong>Network</strong>: Swarm kullanmayÄ± dÃ¼ÅŸÃ¼nÃ¼yorsanÄ±z, bu konu, bilmeniz gerekenlerin baÅŸÄ±nda geliyor. Swarmâ€™daki servis
keÅŸfi, Swarmâ€™la birlikte yaratÄ±lan alt aÄŸlara (ve bunlara baÄŸlÄ± IP havuzlarÄ±) ve servislerle oluÅŸturulan DNS
kayÄ±tlarÄ±na dayanÄ±yor. Swarmâ€™Ä± anlatÄ±rken bu konuya da Ã¶zel olarak deÄŸiniyor olacaÄŸÄ±m.</li><li><strong>Service</strong>: AynÄ± containerâ€™dan bir veya daha fazlasÄ±nÄ±n, ayarlarÄ±yla birlikte gruplanmasÄ±na servis adÄ± veriliyor.
Ã–rneÄŸin bir MySQL containerâ€™Ä±nÄ±z varsa; bu containerâ€™dan kaÃ§ tane Ã§alÄ±ÅŸacaÄŸÄ±nÄ±, hangi makinelere, hangi kurallarla
yerleÅŸtirileceÄŸini, kullanÄ±lacak disk alanlarÄ±nÄ±, dÄ±ÅŸarÄ±ya aÃ§Ä±lacak baÄŸlantÄ± noktalarÄ±nÄ±, Ã§evresel deÄŸiÅŸkenlerini ve
daha bir Ã§ok ayarÄ±nÄ± servis iÃ§erisinde tanÄ±mlayabiliyoruz.</li><li><strong>Stack</strong>: Servislerin, aÄŸlarÄ±n ve disk alanlarÄ±nÄ±n, yapÄ±landÄ±rma dosyalarÄ± ve sÄ±r tanÄ±mlarÄ±nÄ±n oluÅŸturduÄŸu daha
bÃ¼yÃ¼k gruba stack diyoruz. Ã–rneÄŸin, MySQL veritabanÄ±yla konuÅŸan bir uygulamanÄ±z varsa; uygulamanÄ±zÄ± ve veritabanÄ±nÄ±
bir stack iÃ§erisinde tanÄ±mlayÄ±p rahatlÄ±kla yÃ¶netebilirsiniz. Stack yardÄ±mÄ±yla saniyeler iÃ§erisinde uygulamanÄ±zÄ±
yayÄ±na alabilir, kaldÄ±rabilir ya da aÅŸaÄŸÄ±/yukarÄ± Ã¶lÃ§ekleyebilirsiniz.</li></ul><h4 id=docker-swarm-demo-1>Docker Swarm Demo #1<a hidden class=anchor aria-hidden=true href=#docker-swarm-demo-1>#</a></h4><p>Ä°lk denememizi basit tutalÄ±m. <code>tutum/hello-world</code> imajÄ±ndan 2 tane ayaÄŸa kaldÄ±rarak, Swarmâ€™Ä±n basitÃ§e nasÄ±l Ã§alÄ±ÅŸtÄ±ÄŸÄ±nÄ±
gÃ¶relim:</p><pre tabindex=0><code>docker service create -d --name helloworld \
    --constraint engine.labels.role==node \
    -p 80:80 \
    --replicas 2 \
    tutum/hello-world
</code></pre><p>YukarÄ±daki komutla; <code>tutum/hello-world</code> servisini, yalnÄ±zca <code>node</code> rolÃ¼ndeki makinelere, toplamda 2 container olacak
ve 80. baÄŸlantÄ± noktasÄ±nÄ± dÄ±ÅŸarÄ±ya aÃ§acak ÅŸekilde &ldquo;daÄŸÄ±tÄ±yoruz&rdquo; (schedule). Bu komutu Ã§alÄ±ÅŸtÄ±rdÄ±ÄŸÄ±nÄ±zda servise ait
tanÄ±mlayÄ±cÄ±yÄ± (Service ID) dÃ¶necektir. Dilerseniz bu tanÄ±mlayÄ±cÄ±yÄ± ya da servisin ismini vererek sorgulama
yapabilirsiniz:</p><figure><img loading=lazy src=docker_service_komut_ciktilari.png alt="docker service komutlarÄ±yla &amp;ldquo;deploy&amp;rdquo; ettiÄŸimiz servislerimizi, Ã§alÄ±ÅŸtÄ±klarÄ± makineler ve durum bilgileriyle gÃ¶rebiliyoruz."><figcaption><p><code>docker service</code> komutlarÄ±yla &ldquo;deploy&rdquo; ettiÄŸimiz servislerimizi, Ã§alÄ±ÅŸtÄ±klarÄ± makineler ve durum bilgileriyle gÃ¶rebiliyoruz.</p></figcaption></figure><p>Ben makineleri Virtualboxâ€™da yarattÄ±ÄŸÄ±mda aldÄ±ÄŸÄ±m IPâ€™ler ÅŸÃ¶yleymiÅŸ:</p><ul><li><em>mgr1</em>: 192.168.99.101</li><li><em>n1</em>: 192.168.99.102</li><li><em>n2</em>: 192.168.99.103</li></ul><p>Yeni servisimizi test edelim mi? ğŸ¤ğŸ»</p><figure><img loading=lazy src=servis_tarayici_testi.png></figure><p>Hangi makineye istek attÄ±ÄŸÄ±mÄ± farkettiniz mi? 192.168.99.<strong>101</strong>! Yani <code>mgr1</code>! E hani sadece rolÃ¼ <code>node</code> olan
makinelere yerleÅŸtirmiÅŸtik servisi? ğŸ˜³ Åimdi arka arkaya defalarca kez sayfayÄ± yenileyin. &ldquo;My hostname is&rdquo; ifadesinin
karÅŸÄ±sÄ±ndaki tanÄ±mlayÄ±cÄ±nÄ±n sÃ¼rekli deÄŸiÅŸtiÄŸini gÃ¶receksiniz. AynÄ± IPâ€™ye istek atÄ±yoruz ama farklÄ± cevaplar alÄ±yoruz.
Servisimiz bir de yÃ¼k dengeleme yapÄ±yor?! ğŸ˜®</p><p>Bir Ã¼stteki ekran gÃ¶rÃ¼ntÃ¼sÃ¼nde aÃ§Ä±kÃ§a gÃ¶rÃ¼ldÃ¼ÄŸÃ¼ gibi; aslÄ±nda servislerimizden 2 adet var ve yalnÄ±zca rolÃ¼ <code>node</code> olan
<code>n1</code> ve <code>n2</code> makinelerine yerleÅŸtirilmiÅŸ durumda. Peki nasÄ±l oluyor da <code>mgr1</code> makinesine istek atÄ±nca cevap alÄ±yoruz?
Cevap: <strong>ingress</strong> aÄŸÄ±! Docker 1.12+ ile gelen bu Ã¶zellik sayesinde eÄŸer bir servis, dÄ±ÅŸarÄ± herhangi bir baÄŸlantÄ±
noktasÄ± aÃ§arsa, bu baÄŸlantÄ± noktasÄ± tÃ¼m makinelerde aÃ§Ä±lÄ±r ve gelen istekler hangi makineye gelirse gelsin Swarm
Ã¼zerinde o servisi Ã§alÄ±ÅŸtÄ±ran makinelere yÃ¶nlendirilir. Etkileyici, deÄŸil mi? ğŸ‘ğŸ»ğŸ‘ğŸ»ğŸ‘ğŸ»</p><figure><img loading=lazy src=swarm_cluster_semasi.jpeg alt="ingress aÄŸÄ± sayesinde uygulamamÄ±za her makine Ã¼stÃ¼nden eriÅŸilebiliyor! ğŸ‘ğŸ»"><figcaption><p><strong>ingress</strong> aÄŸÄ± sayesinde uygulamamÄ±za her makine Ã¼stÃ¼nden eriÅŸilebiliyor! ğŸ‘ğŸ»</p></figcaption></figure><p>Ãœstteki diagramâ€™da, tÃ¼m VMâ€™lerin Ã¼stÃ¼nde bir yÃ¼k dengeleyici (LB) olduÄŸunu varsayalÄ±m. Bir ÅŸekilde Swarm iÃ§erisindeki
tÃ¼m makinelerin adresini LBâ€™e ekleyebilirsek; tek bir noktadan uygulamamÄ±za Ã¶lÃ§eklenebilir bir ÅŸekilde ulaÅŸabilir hale
gelmiÅŸ oluyoruz. Diyelim ki; uygulamamÄ±z bu ÅŸekilde Ã§alÄ±ÅŸÄ±rken Ã§ok fazla istek gelmeye baÅŸladÄ± ve birer containerâ€™a
daha ihtiyacÄ±mÄ±z var. Tek yapmamÄ±z gereken:</p><figure><img loading=lazy src=swarm_scale_ps_ciktisi.png></figure><p>Bir ÅŸey dikkatinizi Ã§ekti mi? YalnÄ±zca 2 <code>node</code> makinemiz var ve bu nedenle aynÄ± servisten her makinede artÄ±k iki adet
Ã§alÄ±ÅŸmaya baÅŸladÄ±. Peki ama 80. baÄŸlantÄ± noktasÄ±nÄ± hala nasÄ±l dinliyoruz? SÃ¼rekli istek atarsanÄ±z, yukarÄ±daki ekran
gÃ¶rÃ¼ntÃ¼sÃ¼nÃ¼n de teyid ettiÄŸi ÅŸekilde, 4 tane containerâ€™Ä±n da baÅŸarÄ±lÄ± ÅŸekilde Ã§alÄ±ÅŸtÄ±ÄŸÄ±nÄ± gÃ¶receksiniz.</p><p>CevabÄ± aslÄ±nda yukarÄ±daki diyagramâ€™da! Ingress aÄŸÄ± her zaman mevcut ve herhangi bir ayar yapmanÄ±za gerek kalmaksÄ±zÄ±n,
servisleriniz iÃ§in baÅŸlatÄ±lan her containerâ€™a bu aÄŸÄ±n IP havuzundan farklÄ± bir adres veriliyor. Swarm iÃ§erisinde
Ã§alÄ±ÅŸan yÃ¼k dengeleyiciler, her makinede dinlenen 80. baÄŸlantÄ± noktasÄ±nÄ±n, hangi containerâ€™lara yÃ¶nlendirileceÄŸini
yaptÄ±ÄŸÄ±nÄ±z servis tanÄ±mÄ±ndan dolayÄ± biliyorlar ve otomatik olarak istekleri yÃ¶nlendiriyorlar!</p><p><code>n1</code> ya da <code>n2</code>&lsquo;ye baÄŸlanÄ±p container&rsquo;larÄ± rastgele Ã¶ldÃ¼rmeyi deneyin. Swarm, otomatik olarak yeni container&rsquo;lar
baÅŸlatacak ve Ã¶lÃ§eklenebilirlik iÃ§in ayarladÄ±ÄŸÄ±nÄ±z &ldquo;minimum 4 container olsun&rdquo; kuralÄ±nÄ± saÄŸlamaya devam edecektir. ğŸ‰</p><p>Servisinize ait imajÄ± (Ã¶rneÄŸin uygulamanÄ±zÄ±n yeni sÃ¼rÃ¼mÃ¼ Ã§Ä±ktÄ±ÄŸÄ±nda), Ã§evresel deÄŸiÅŸkenleri, yapÄ±landÄ±rma ya da sÄ±r
dosyalarÄ±nÄ±, yerleÅŸim ayarlarÄ±nÄ± ve diÄŸer pek Ã§ok ayarÄ±, servisinizi kapatmak zorunda kalmadan ya da herhangi bir
servis dÄ±ÅŸÄ± durum oluÅŸmadan gÃ¼ncelleyebilirsiniz:</p><pre tabindex=0><code>docker service update -d \
    --env-add server.port=8080
    --label-add foo=bar \
    helloworld
</code></pre><p>DeÄŸiÅŸtirebileceÄŸiniz ayarlarla ilgili daha detaylÄ± bilgi almak iÃ§in;</p><pre tabindex=0><code>docker service update --help
</code></pre><p>komutunu kullanabilirsiniz. YaptÄ±ÄŸÄ±nÄ±z deÄŸiÅŸikliklerde bir problem oluÅŸmasÄ± halinde bir Ã¶nceki kararlÄ± duruma geri
dÃ¶nmek iÃ§in</p><pre tabindex=0><code>docker service rollback helloworld
</code></pre><p>komutunu kullanabilirsiniz.</p><p>Servislerin gÃ¼Ã§lÃ¼ Ã¶zelliklerinden bir diÄŸeri ise tÃ¼m containerâ€™larÄ±n log kayÄ±tlarÄ±nÄ± bir arada gÃ¶rme ÅŸansÄ± vermesi:</p><pre tabindex=0><code>docker service logs --tail 10 -f helloworld
</code></pre><p>KiÅŸisel fikrimi sorarsanÄ±z; bu Ã¶zellik oldukÃ§a iÅŸe yarÄ±yor olmakla beraber gerÃ§ek ortamda Ã§alÄ±ÅŸan servisler iÃ§in pek
yeterli olmuyor. Birden fazla makinenin kayÄ±tlarÄ±nÄ± bir araya topladÄ±ÄŸÄ±nÄ±zdan birbirine girmiÅŸ karman Ã§orman kayÄ±tlarla
karÅŸÄ±laÅŸabiliyorsunuz. Ancak Dockerâ€™Ä±n log sÃ¼rÃ¼cÃ¼leri Ã¼stÃ¼nden bu kayÄ±tlarÄ±
<a href=https://www.elastic.co/products/logstash>logstash</a> vb. servislerle paylaÅŸabildiÄŸini dÃ¼ÅŸÃ¼nÃ¼rsek Ã§ok da mÃ¼him deÄŸil.</p><p>KÃ¼Ã§Ã¼k ve fazla baÄŸÄ±mlÄ±lÄ±klarÄ± olmayan projelerinizi yalnÄ±zca <code>docker service</code> komutlarÄ±yla sunuculara daÄŸÄ±tabilir ve
Ã¶lÃ§ekleyebilirsiniz. Daha bÃ¼yÃ¼k Ã¶lÃ§ekli projeler iÃ§in yapÄ±lmasÄ± gerekenleri serinin bir sonraki yazÄ±sÄ±nda ele alacaÄŸÄ±m.</p><p>BilgisayarÄ±nÄ±zÄ±n kaynaklarÄ±nÄ± boÅŸ yere harcamamak iÃ§in oluÅŸturduÄŸunuz servisi;</p><pre tabindex=0><code>docker service rm helloworld
</code></pre><p>komutuyla, Docker Makine ile yarattÄ±ÄŸÄ±nÄ±z VMâ€™leri ise;</p><pre tabindex=0><code>docker-machine rm mgr1 n1 n2
</code></pre><p>komutuyla silebilirsiniz.</p><hr><p>Bu bÃ¶lÃ¼mÃ¼nÃ¼n de sonuna geldik. Bir sonraki bÃ¶lÃ¼m olan &ldquo;Docker Serisi #5 â€” Docker Machine & Swarm BÃ¶lÃ¼m 2&rdquo;&lsquo;de gÃ¶rÃ¼ÅŸmek
dileÄŸiyle!</p><p>GidiÅŸÃ¢ta gÃ¶re bu planda zaman zaman deÄŸiÅŸiklikler yapacak olsam da serinin tÃ¼m bÃ¶lÃ¼mlerinin planÄ±na
<a href=https://www.evernote.com/l/AB7CctYtJkpMUJsae1_3FgzIXgMY5MvFQhU>ÅŸuradan</a> ulaÅŸabilirsiniz.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://alperkan.at/tr/tags/yaz%C4%B1l%C4%B1m/>yazÄ±lÄ±m</a></li><li><a href=https://alperkan.at/tr/tags/docker/>docker</a></li><li><a href=https://alperkan.at/tr/tags/docker-serisi/>docker serisi</a></li><li><a href=https://alperkan.at/tr/tags/container/>container</a></li><li><a href=https://alperkan.at/tr/tags/sanalla%C5%9Ft%C4%B1rma/>sanallaÅŸtÄ±rma</a></li><li><a href=https://alperkan.at/tr/tags/linux/>linux</a></li><li><a href=https://alperkan.at/tr/tags/devops/>devops</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2022 <a href=https://alperkan.at/tr/>Alper Kanat</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)"><button class=top-link id=top-link type=button accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></button></a>
<script>let menu=document.getElementById("menu");menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)},document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>